(()=>{"use strict";var e={d:(t,s)=>{for(var n in s)e.o(s,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:s[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{xX:()=>Y,qA:()=>Z,LG:()=>Q,cH:()=>G,pJ:()=>z,v3:()=>te,v7:()=>ee,fK:()=>re,PO:()=>ae,m_:()=>ne,Ll:()=>se,OE:()=>ie,Is:()=>oe});var s={};e.r(s),e.d(s,{xX:()=>Bs,qA:()=>qs,LG:()=>js,cH:()=>Ns,v3:()=>Ls,v7:()=>Ds,fK:()=>Fs,pf:()=>Ks,PO:()=>Js,k5:()=>Vs,m_:()=>Ws,vc:()=>Ts,Ll:()=>Us,OE:()=>Hs,Is:()=>Xs});const n="0.28.0";let r,o,i,a,c,l,u=!1,h=null,d=null,f=null,p=null,m=null,g=null,y=null;class w{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}r||function(e,t={auto:!1}){if(u)throw new Error(`you must \`import '@anthropic-ai/sdk/shims/${e.kind}'\` before importing anything else from @anthropic-ai/sdk`);if(r)throw new Error(`can't \`import '@anthropic-ai/sdk/shims/${e.kind}'\` after \`import '@anthropic-ai/sdk/shims/${r}'\``);u=t.auto,r=e.kind,o=e.fetch,h=e.Request,d=e.Response,f=e.Headers,p=e.FormData,m=e.Blob,i=e.File,a=e.ReadableStream,g=e.getMultipartRequestOptions,c=e.getDefaultAgent,l=e.fileFromPath,y=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from '@anthropic-ai/sdk'`:\n- `import '@anthropic-ai/sdk/shims/node'` (if you're running on Node)\n- `import '@anthropic-ai/sdk/shims/web'` (otherwise)\n";let s,n,r,o;try{s=fetch,n=Request,r=Response,o=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:s,Request:n,Response:r,Headers:o,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new w(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/anthropics/anthropic-sdk-typescript#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class b{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;return new b((async function*(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const s of async function*(e,t){if(!e.body)throw t.abort(),new z("Attempted to iterate over a response with no body");const s=new v,n=new x,r=S(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const s of e){if(null==s)continue;const e=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?(new TextEncoder).encode(s):s;let n,r=new Uint8Array(t.length+e.length);for(r.set(t),r.set(e,t.length),t=r;-1!==(n=_(t));)yield t.slice(0,n),t=t.slice(n)}t.length>0&&(yield t)}(r))for(const t of n.decode(e)){const e=s.decode(t);e&&(yield e)}for(const e of n.flush()){const t=s.decode(e);t&&(yield t)}}(e,t)){if("completion"===s.event)try{yield JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("message_start"===s.event||"message_delta"===s.event||"message_stop"===s.event||"content_block_start"===s.event||"content_block_delta"===s.event||"content_block_stop"===s.event)try{yield JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("ping"!==s.event&&"error"===s.event)throw Q.generate(void 0,`SSE Error: ${s.data}`,s.data,$(e.headers))}n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}}),t)}static fromReadableStream(e,t){let s=!1;return new b((async function*(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const t of async function*(){const t=new x,s=S(e);for await(const e of s)for(const s of t.decode(e))yield s;for(const e of t.flush())yield e}())n||t&&(yield JSON.parse(t));n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){const n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new b((()=>n(e)),this.controller),new b((()=>n(t)),this.controller)]}toReadableStream(){const e=this;let t;const s=new TextEncoder;return new a({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:r}=await t.next();if(r)return e.close();const o=s.encode(JSON.stringify(n)+"\n");e.enqueue(o)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}function _(e){for(let t=0;t<e.length-2;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}class v{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e){const t=e.indexOf(":");return-1!==t?[e.substring(0,t),":",e.substring(t+1)]:[e,"",""]}(e);return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}class x{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const s=x.NEWLINE_CHARS.has(t[t.length-1]||"");let n=t.split(x.NEWLINE_REGEXP);return s&&n.pop(),1!==n.length||s?(this.buffer.length>0&&(n=[this.buffer.join("")+n[0],...n.slice(1)],this.buffer=[]),s||(this.buffer=[n.pop()||""]),n):(this.buffer.push(n[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new z(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new z(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new z("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function S(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}x.NEWLINE_CHARS=new Set(["\n","\r"]),x.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const R=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;const A=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,k=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],E=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag];async function P(e){const{response:t}=e;if(e.options.stream)return J("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):b.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const s=t.headers.get("content-type");if(s?.includes("application/json")||s?.includes("application/vnd.api+json")){const e=await t.json();return J("response",t.status,t.url,t.headers,e),e}const n=await t.text();return J("response",t.status,t.url,t.headers,n),n}class C extends Promise{constructor(e,t=P){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new C(this.responsePromise,(async t=>e(await this.parseResponse(t))))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class I{constructor({baseURL:e,maxRetries:t=2,timeout:s=6e5,httpAgent:n,fetch:r}){this.baseURL=e,this.maxRetries=U("maxRetries",t),this.timeout=U("timeout",s),this.httpAgent=n,this.fetch=r??o}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...N(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${V()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then((async s=>{const n=s&&R(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:t,...s,body:n}})))}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const{method:s,path:n,query:r,headers:o={}}=e,i=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:E(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,a=this.calculateContentLength(i),l=this.buildURL(n,r);"timeout"in e&&U("timeout",e.timeout);const u=e.timeout??this.timeout,h=e.httpAgent??this.httpAgent??c(l),d=u+1e3;return"number"==typeof h?.options?.timeout&&d>(h.options.timeout??0)&&(h.options.timeout=d),this.idempotencyHeader&&"get"!==s&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey),{req:{method:s,...i&&{body:i},headers:this.buildHeaders({options:e,headers:o,contentLength:a,retryCount:t}),...h&&{agent:h},signal:e.signal??null},url:l,timeout:u}}buildHeaders({options:e,headers:t,contentLength:s,retryCount:n}){const o={};return s&&(o["content-length"]=s),H(o,this.defaultHeaders(e)),H(o,t),E(e.body)&&"node"!==r&&delete o["content-type"],void 0===K(t,"x-stainless-retry-count")&&(o["x-stainless-retry-count"]=String(n)),this.validateHeaders(o,t),o}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,s,n){return Q.generate(e,t,s,n)}request(e,t=null){return new C(this.makeRequest(e,t))}async makeRequest(e,t){const s=await e,n=s.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(s);const{req:r,url:o,timeout:i}=this.buildRequest(s,{retryCount:n-t});if(await this.prepareRequest(r,{url:o,options:s}),J("request",o,s,r.headers),s.signal?.aborted)throw new G;const a=new AbortController,c=await this.fetchWithTimeout(o,r,i,a).catch(W);if(c instanceof Error){if(s.signal?.aborted)throw new G;if(t)return this.retryRequest(s,t);if("AbortError"===c.name)throw new Z;throw new Y({cause:c})}const l=$(c.headers);if(!c.ok){if(t&&this.shouldRetry(c))return J(`response (error; retrying, ${t} attempts remaining)`,c.status,o,l),this.retryRequest(s,t,l);const e=await c.text().catch((e=>W(e).message)),n=B(e),r=n?void 0:e;throw J(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,o,l,r),this.makeStatusError(c.status,n,r,l)}return{response:c,options:s,controller:a}}requestAPIList(e,t){const s=this.makeRequest(t,null);return new O(this,s,e)}buildURL(e,t){const s=D(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return X(n)||(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new z(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,s,n){const{signal:r,...o}=t||{};r&&r.addEventListener("abort",(()=>n.abort()));const i=setTimeout((()=>n.abort()),s);return this.getRequestClient().fetch.call(void 0,e,{signal:n.signal,...o}).finally((()=>{clearTimeout(i)}))}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,s){let n;const r=s?.["retry-after-ms"];if(r){const e=parseFloat(r);Number.isNaN(e)||(n=e)}const o=s?.["retry-after"];if(o&&!n){const e=parseFloat(o);n=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){const s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await L(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const s=t-e;return Math.min(.5*Math.pow(2,s),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${n}`}}new WeakMap,Symbol.asyncIterator;class O extends C{constructor(e,t,s){super(t,(async t=>new s(e,t.response,await P(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const $=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const s=t.toString();return e[s.toLowerCase()]||e[s]}}),M=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",T=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let j;const N=()=>j??(j=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n,"X-Stainless-OS":T(Deno.build.os),"X-Stainless-Arch":M(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n,"X-Stainless-OS":T(process.platform),"X-Stainless-Arch":M(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:s}of e){const e=s.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":n,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),B=e=>{try{return JSON.parse(e)}catch(e){return}},q=new RegExp("^(?:[a-z]+:)?//","i"),D=e=>q.test(e),L=e=>new Promise((t=>setTimeout(t,e))),U=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new z(`${e} must be an integer`);if(t<0)throw new z(`${e} must be a positive integer`);return t},W=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(String(e))},F=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function X(e){if(!e)return!0;for(const t in e)return!1;return!0}function H(e,t){for(const r in t){if(s=t,n=r,!Object.prototype.hasOwnProperty.call(s,n))continue;const o=r.toLowerCase();if(!o)continue;const i=t[r];null===i?delete e[o]:void 0!==i&&(e[o]=i)}var s,n}function J(e,...t){"undefined"!=typeof process&&"true"===process?.env?.DEBUG&&console.log(`Anthropic:DEBUG:${e}`,...t)}const V=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),K=(e,t)=>{const s=t.toLowerCase();if((e=>"function"==typeof e?.get)(e)){const n=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,((e,t,s)=>t+s.toUpperCase()));for(const r of[t,s,t.toUpperCase(),n]){const t=e.get(r);if(t)return t}}for(const[n,r]of Object.entries(e))if(n.toLowerCase()===s)return Array.isArray(r)?(r.length<=1||console.warn(`Received ${r.length} entries for the ${t} header, using the first entry.`),r[0]):r};class z extends Error{}class Q extends z{constructor(e,t,s,n){super(`${Q.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.request_id=n?.["request-id"],this.error=t}static makeMessage(e,t,s){const n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e)return new Y({message:s,cause:W(t)});const r=t;return 400===e?new ee(e,r,s,n):401===e?new te(e,r,s,n):403===e?new se(e,r,s,n):404===e?new ne(e,r,s,n):409===e?new re(e,r,s,n):422===e?new oe(e,r,s,n):429===e?new ie(e,r,s,n):e>=500?new ae(e,r,s,n):new Q(e,r,s,n)}}class G extends Q{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class Y extends Q{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class Z extends Y{constructor({message:e}={}){super({message:e??"Request timed out."})}}class ee extends Q{constructor(){super(...arguments),this.status=400}}class te extends Q{constructor(){super(...arguments),this.status=401}}class se extends Q{constructor(){super(...arguments),this.status=403}}class ne extends Q{constructor(){super(...arguments),this.status=404}}class re extends Q{constructor(){super(...arguments),this.status=409}}class oe extends Q{constructor(){super(...arguments),this.status=422}}class ie extends Q{constructor(){super(...arguments),this.status=429}}class ae extends Q{}class ce{constructor(e){this._client=e}}class le extends ce{create(e,t){return this._client.post("/v1/complete",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}}le||(le={});const ue=e=>{if(0===e.length)return e;let t=e[e.length-1];switch(t.type){case"separator":return e=e.slice(0,e.length-1),ue(e);case"number":let s=t.value[t.value.length-1];if("."===s||"-"===s)return e=e.slice(0,e.length-1),ue(e);case"string":let n=e[e.length-2];if("delimiter"===n?.type)return e=e.slice(0,e.length-1),ue(e);if("brace"===n?.type&&"{"===n.value)return e=e.slice(0,e.length-1),ue(e);break;case"delimiter":return e=e.slice(0,e.length-1),ue(e)}return e},he=e=>JSON.parse((e=>{let t="";return e.map((e=>{"string"===e.type?t+='"'+e.value+'"':t+=e.value})),t})((e=>{let t=[];return e.map((e=>{"brace"===e.type&&("{"===e.value?t.push("}"):t.splice(t.lastIndexOf("}"),1)),"paren"===e.type&&("["===e.value?t.push("]"):t.splice(t.lastIndexOf("]"),1))})),t.length>0&&t.reverse().map((t=>{"}"===t?e.push({type:"brace",value:"}"}):"]"===t&&e.push({type:"paren",value:"]"})})),e})(ue((e=>{let t=0,s=[];for(;t<e.length;){let n=e[t];if("\\"===n){t++;continue}if("{"===n){s.push({type:"brace",value:"{"}),t++;continue}if("}"===n){s.push({type:"brace",value:"}"}),t++;continue}if("["===n){s.push({type:"paren",value:"["}),t++;continue}if("]"===n){s.push({type:"paren",value:"]"}),t++;continue}if(":"===n){s.push({type:"separator",value:":"}),t++;continue}if(","===n){s.push({type:"delimiter",value:","}),t++;continue}if('"'===n){let r="",o=!1;for(n=e[++t];'"'!==n;){if(t===e.length){o=!0;break}if("\\"===n){if(t++,t===e.length){o=!0;break}r+=n+e[t],n=e[++t]}else r+=n,n=e[++t]}n=e[++t],o||s.push({type:"string",value:r});continue}if(n&&/\s/.test(n)){t++;continue}let r=/[0-9]/;if(n&&r.test(n)||"-"===n||"."===n){let o="";for("-"===n&&(o+=n,n=e[++t]);n&&r.test(n)||"."===n;)o+=n,n=e[++t];s.push({type:"number",value:o});continue}let o=/[a-z]/i;if(n&&o.test(n)){let r="";for(;n&&o.test(n)&&t!==e.length;)r+=n,n=e[++t];if("true"!=r&&"false"!=r&&"null"!==r){t++;continue}s.push({type:"name",value:r})}else t++}return s})(e)))));var de,fe,pe,me,ge,ye,we,be,_e,ve,xe,Se,Re,Ae,ke,Ee,Pe,Ce,Ie,Oe,$e=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s},Me=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};const Te="__json_buf";class je{constructor(){de.add(this),this.messages=[],this.receivedMessages=[],fe.set(this,void 0),this.controller=new AbortController,pe.set(this,void 0),me.set(this,(()=>{})),ge.set(this,(()=>{})),ye.set(this,void 0),we.set(this,(()=>{})),be.set(this,(()=>{})),_e.set(this,{}),ve.set(this,!1),xe.set(this,!1),Se.set(this,!1),Re.set(this,!1),Ee.set(this,(e=>{if($e(this,xe,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new G),e instanceof G)return $e(this,Se,!0,"f"),this._emit("abort",e);if(e instanceof z)return this._emit("error",e);if(e instanceof Error){const t=new z(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new z(String(e)))})),$e(this,pe,new Promise(((e,t)=>{$e(this,me,e,"f"),$e(this,ge,t,"f")})),"f"),$e(this,ye,new Promise(((e,t)=>{$e(this,we,e,"f"),$e(this,be,t,"f")})),"f"),Me(this,pe,"f").catch((()=>{})),Me(this,ye,"f").catch((()=>{}))}static fromReadableStream(e){const t=new je;return t._run((()=>t._fromReadableStream(e))),t}static createMessage(e,t,s){const n=new je;for(const e of t.messages)n._addMessageParam(e);return n._run((()=>n._createMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),n}_run(e){e().then((()=>{this._emitFinal(),this._emit("end")}),Me(this,Ee,"f"))}_addMessageParam(e){this.messages.push(e)}_addMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createMessage(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),Me(this,de,"m",Pe).call(this);const r=await e.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const e of r)Me(this,de,"m",Ce).call(this,e);if(r.controller.signal?.aborted)throw new G;Me(this,de,"m",Ie).call(this)}_connected(){this.ended||(Me(this,me,"f").call(this),this._emit("connect"))}get ended(){return Me(this,ve,"f")}get errored(){return Me(this,xe,"f")}get aborted(){return Me(this,Se,"f")}abort(){this.controller.abort()}on(e,t){return(Me(this,_e,"f")[e]||(Me(this,_e,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=Me(this,_e,"f")[e];if(!s)return this;const n=s.findIndex((e=>e.listener===t));return n>=0&&s.splice(n,1),this}once(e,t){return(Me(this,_e,"f")[e]||(Me(this,_e,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,s)=>{$e(this,Re,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)}))}async done(){$e(this,Re,!0,"f"),await Me(this,ye,"f")}get currentMessage(){return Me(this,fe,"f")}async finalMessage(){return await this.done(),Me(this,de,"m",Ae).call(this)}async finalText(){return await this.done(),Me(this,de,"m",ke).call(this)}_emit(e,...t){if(Me(this,ve,"f"))return;"end"===e&&($e(this,ve,!0,"f"),Me(this,we,"f").call(this));const s=Me(this,_e,"f")[e];if(s&&(Me(this,_e,"f")[e]=s.filter((e=>!e.once)),s.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return Me(this,Re,"f")||s?.length||Promise.reject(e),Me(this,ge,"f").call(this,e),Me(this,be,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];Me(this,Re,"f")||s?.length||Promise.reject(e),Me(this,ge,"f").call(this,e),Me(this,be,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalMessage",Me(this,de,"m",Ae).call(this))}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),Me(this,de,"m",Pe).call(this),this._connected();const n=b.fromReadableStream(e,this.controller);for await(const e of n)Me(this,de,"m",Ce).call(this,e);if(n.controller.signal?.aborted)throw new G;Me(this,de,"m",Ie).call(this)}[(fe=new WeakMap,pe=new WeakMap,me=new WeakMap,ge=new WeakMap,ye=new WeakMap,we=new WeakMap,be=new WeakMap,_e=new WeakMap,ve=new WeakMap,xe=new WeakMap,Se=new WeakMap,Re=new WeakMap,Ee=new WeakMap,de=new WeakSet,Ae=function(){if(0===this.receivedMessages.length)throw new z("stream ended without producing a Message with role=assistant");return this.receivedMessages.at(-1)},ke=function(){if(0===this.receivedMessages.length)throw new z("stream ended without producing a Message with role=assistant");const e=this.receivedMessages.at(-1).content.filter((e=>"text"===e.type)).map((e=>e.text));if(0===e.length)throw new z("stream ended without producing a content block with type=text");return e.join(" ")},Pe=function(){this.ended||$e(this,fe,void 0,"f")},Ce=function(e){if(this.ended)return;const t=Me(this,de,"m",Oe).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{const s=t.content.at(-1);"text_delta"===e.delta.type&&"text"===s.type?this._emit("text",e.delta.text,s.text||""):"input_json_delta"===e.delta.type&&"tool_use"===s.type&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break}case"message_stop":this._addMessageParam(t),this._addMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":$e(this,fe,t,"f")}},Ie=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");const e=Me(this,fe,"f");if(!e)throw new z("request ended without sending any chunks");return $e(this,fe,void 0,"f"),e},Oe=function(e){let t=Me(this,fe,"f");if("message_start"===e.type){if(t)throw new z(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new z(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{const s=t.content.at(e.index);if("text"===s?.type&&"text_delta"===e.delta.type)s.text+=e.delta.text;else if("tool_use"===s?.type&&"input_json_delta"===e.delta.type){let t=s[Te]||"";t+=e.delta.partial_json,Object.defineProperty(s,Te,{value:t,enumerable:!1,writable:!0}),t&&(s.input=he(t))}return t}}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new b(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class Ne extends ce{create(e,t){return e.model in Be&&console.warn(`The model '${e.model}' is deprecated and will reach end-of-life on ${Be[e.model]}\nPlease migrate to a newer model. Visit https://docs.anthropic.com/en/docs/resources/model-deprecations for more information.`),this._client.post("/v1/messages",{body:e,timeout:this._client._options.timeout??6e5,...t,stream:e.stream??!1})}stream(e,t){return je.createMessage(this,e,t)}}const Be={"claude-1.3":"November 6th, 2024","claude-1.3-100k":"November 6th, 2024","claude-instant-1.1":"November 6th, 2024","claude-instant-1.1-100k":"November 6th, 2024","claude-instant-1.2":"November 6th, 2024"};Ne||(Ne={});var qe,De,Le,Ue,We,Fe,Xe,He,Je,Ve,Ke,ze,Qe,Ge,Ye,Ze,et,tt,st,nt,rt=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s},ot=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};const it="__json_buf";class at{constructor(){qe.add(this),this.messages=[],this.receivedMessages=[],De.set(this,void 0),this.controller=new AbortController,Le.set(this,void 0),Ue.set(this,(()=>{})),We.set(this,(()=>{})),Fe.set(this,void 0),Xe.set(this,(()=>{})),He.set(this,(()=>{})),Je.set(this,{}),Ve.set(this,!1),Ke.set(this,!1),ze.set(this,!1),Qe.set(this,!1),Ze.set(this,(e=>{if(rt(this,Ke,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new G),e instanceof G)return rt(this,ze,!0,"f"),this._emit("abort",e);if(e instanceof z)return this._emit("error",e);if(e instanceof Error){const t=new z(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new z(String(e)))})),rt(this,Le,new Promise(((e,t)=>{rt(this,Ue,e,"f"),rt(this,We,t,"f")})),"f"),rt(this,Fe,new Promise(((e,t)=>{rt(this,Xe,e,"f"),rt(this,He,t,"f")})),"f"),ot(this,Le,"f").catch((()=>{})),ot(this,Fe,"f").catch((()=>{}))}static fromReadableStream(e){const t=new at;return t._run((()=>t._fromReadableStream(e))),t}static createMessage(e,t,s){const n=new at;for(const e of t.messages)n._addPromptCachingBetaMessageParam(e);return n._run((()=>n._createPromptCachingBetaMessage(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),n}_run(e){e().then((()=>{this._emitFinal(),this._emit("end")}),ot(this,Ze,"f"))}_addPromptCachingBetaMessageParam(e){this.messages.push(e)}_addPromptCachingBetaMessage(e,t=!0){this.receivedMessages.push(e),t&&this._emit("message",e)}async _createPromptCachingBetaMessage(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),ot(this,qe,"m",et).call(this);const r=await e.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const e of r)ot(this,qe,"m",tt).call(this,e);if(r.controller.signal?.aborted)throw new G;ot(this,qe,"m",st).call(this)}_connected(){this.ended||(ot(this,Ue,"f").call(this),this._emit("connect"))}get ended(){return ot(this,Ve,"f")}get errored(){return ot(this,Ke,"f")}get aborted(){return ot(this,ze,"f")}abort(){this.controller.abort()}on(e,t){return(ot(this,Je,"f")[e]||(ot(this,Je,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=ot(this,Je,"f")[e];if(!s)return this;const n=s.findIndex((e=>e.listener===t));return n>=0&&s.splice(n,1),this}once(e,t){return(ot(this,Je,"f")[e]||(ot(this,Je,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,s)=>{rt(this,Qe,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)}))}async done(){rt(this,Qe,!0,"f"),await ot(this,Fe,"f")}get currentMessage(){return ot(this,De,"f")}async finalMessage(){return await this.done(),ot(this,qe,"m",Ge).call(this)}async finalText(){return await this.done(),ot(this,qe,"m",Ye).call(this)}_emit(e,...t){if(ot(this,Ve,"f"))return;"end"===e&&(rt(this,Ve,!0,"f"),ot(this,Xe,"f").call(this));const s=ot(this,Je,"f")[e];if(s&&(ot(this,Je,"f")[e]=s.filter((e=>!e.once)),s.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return ot(this,Qe,"f")||s?.length||Promise.reject(e),ot(this,We,"f").call(this,e),ot(this,He,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];ot(this,Qe,"f")||s?.length||Promise.reject(e),ot(this,We,"f").call(this,e),ot(this,He,"f").call(this,e),this._emit("end")}}_emitFinal(){this.receivedMessages.at(-1)&&this._emit("finalPromptCachingBetaMessage",ot(this,qe,"m",Ge).call(this))}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),ot(this,qe,"m",et).call(this),this._connected();const n=b.fromReadableStream(e,this.controller);for await(const e of n)ot(this,qe,"m",tt).call(this,e);if(n.controller.signal?.aborted)throw new G;ot(this,qe,"m",st).call(this)}[(De=new WeakMap,Le=new WeakMap,Ue=new WeakMap,We=new WeakMap,Fe=new WeakMap,Xe=new WeakMap,He=new WeakMap,Je=new WeakMap,Ve=new WeakMap,Ke=new WeakMap,ze=new WeakMap,Qe=new WeakMap,Ze=new WeakMap,qe=new WeakSet,Ge=function(){if(0===this.receivedMessages.length)throw new z("stream ended without producing a PromptCachingBetaMessage with role=assistant");return this.receivedMessages.at(-1)},Ye=function(){if(0===this.receivedMessages.length)throw new z("stream ended without producing a PromptCachingBetaMessage with role=assistant");const e=this.receivedMessages.at(-1).content.filter((e=>"text"===e.type)).map((e=>e.text));if(0===e.length)throw new z("stream ended without producing a content block with type=text");return e.join(" ")},et=function(){this.ended||rt(this,De,void 0,"f")},tt=function(e){if(this.ended)return;const t=ot(this,qe,"m",nt).call(this,e);switch(this._emit("streamEvent",e,t),e.type){case"content_block_delta":{const s=t.content.at(-1);"text_delta"===e.delta.type&&"text"===s.type?this._emit("text",e.delta.text,s.text||""):"input_json_delta"===e.delta.type&&"tool_use"===s.type&&s.input&&this._emit("inputJson",e.delta.partial_json,s.input);break}case"message_stop":this._addPromptCachingBetaMessageParam(t),this._addPromptCachingBetaMessage(t,!0);break;case"content_block_stop":this._emit("contentBlock",t.content.at(-1));break;case"message_start":rt(this,De,t,"f")}},st=function(){if(this.ended)throw new z("stream has ended, this shouldn't happen");const e=ot(this,De,"f");if(!e)throw new z("request ended without sending any chunks");return rt(this,De,void 0,"f"),e},nt=function(e){let t=ot(this,De,"f");if("message_start"===e.type){if(t)throw new z(`Unexpected event order, got ${e.type} before receiving "message_stop"`);return e.message}if(!t)throw new z(`Unexpected event order, got ${e.type} before "message_start"`);switch(e.type){case"message_stop":case"content_block_stop":return t;case"message_delta":return t.stop_reason=e.delta.stop_reason,t.stop_sequence=e.delta.stop_sequence,t.usage.output_tokens=e.usage.output_tokens,t;case"content_block_start":return t.content.push(e.content_block),t;case"content_block_delta":{const s=t.content.at(e.index);if("text"===s?.type&&"text_delta"===e.delta.type)s.text+=e.delta.text;else if("tool_use"===s?.type&&"input_json_delta"===e.delta.type){let t=s[it]||"";t+=e.delta.partial_json,Object.defineProperty(s,it,{value:t,enumerable:!1,writable:!0}),t&&(s.input=he(t))}return t}}},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("streamEvent",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new b(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}class ct extends ce{create(e,t){return this._client.post("/v1/messages?beta=prompt_caching",{body:e,timeout:this._client._options.timeout??6e5,...t,headers:{"anthropic-beta":"prompt-caching-2024-07-31",...t?.headers},stream:e.stream??!1})}stream(e,t){return at.createMessage(this,e,t)}}ct||(ct={});class lt extends ce{constructor(){super(...arguments),this.messages=new ct(this._client)}}!function(e){e.Messages=ct}(lt||(lt={}));class ut extends ce{constructor(){super(...arguments),this.promptCaching=new lt(this._client)}}var ht;!function(e){e.PromptCaching=lt}(ut||(ut={}));class dt extends I{constructor({baseURL:e=F("ANTHROPIC_BASE_URL"),apiKey:t=F("ANTHROPIC_API_KEY")??null,authToken:s=F("ANTHROPIC_AUTH_TOKEN")??null,...n}={}){const r={apiKey:t,authToken:s,...n,baseURL:e||"https://api.anthropic.com"};if(!r.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new z("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew Anthropic({ apiKey, dangerouslyAllowBrowser: true });\n\nTODO: link!\n");super({baseURL:r.baseURL,timeout:r.timeout??6e5,httpAgent:r.httpAgent,maxRetries:r.maxRetries,fetch:r.fetch}),this.completions=new le(this),this.messages=new Ne(this),this.beta=new ut(this),this._options=r,this.apiKey=t,this.authToken=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),...this._options.dangerouslyAllowBrowser?{"anthropic-dangerous-direct-browser-access":"true"}:void 0,"anthropic-version":"2023-06-01",...this._options.defaultHeaders}}validateHeaders(e,t){if(!(this.apiKey&&e["x-api-key"]||null===t["x-api-key"]||this.authToken&&e.authorization||null===t.authorization))throw new Error('Could not resolve authentication method. Expected either apiKey or authToken to be set. Or for one of the "X-Api-Key" or "Authorization" headers to be explicitly omitted')}authHeaders(e){const t=this.apiKeyAuth(e),s=this.bearerAuth(e);return null==t||X(t)?null==s||X(s)?{}:s:t}apiKeyAuth(e){return null==this.apiKey?{}:{"X-Api-Key":this.apiKey}}bearerAuth(e){return null==this.authToken?{}:{Authorization:`Bearer ${this.authToken}`}}}ht=dt,dt.Anthropic=ht,dt.HUMAN_PROMPT="\n\nHuman:",dt.AI_PROMPT="\n\nAssistant:",dt.DEFAULT_TIMEOUT=6e5,dt.AnthropicError=z,dt.APIError=Q,dt.APIConnectionError=Y,dt.APIConnectionTimeoutError=Z,dt.APIUserAbortError=G,dt.NotFoundError=ne,dt.ConflictError=re,dt.RateLimitError=ie,dt.BadRequestError=ee,dt.AuthenticationError=te,dt.InternalServerError=ae,dt.PermissionDeniedError=se,dt.UnprocessableEntityError=oe,dt.toFile=async function(e,t,s){if((e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&R(e))(e=await e))return e;if((e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob)(e)){const n=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const r=R(n)?[await n.arrayBuffer()]:[n];return new i(r,t,s)}const n=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(R(e))t.push(await e.arrayBuffer());else{if(!k(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){return`[${Object.getOwnPropertyNames(e).map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const s of e)t.push(s)}return t}(e);if(t||(t=function(e){return A(e.name)||A(e.filename)||A(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!s?.type){const e=n[0]?.type;"string"==typeof e&&(s={...s,type:e})}return new i(n,t,s)},dt.fileFromPath=l;const{HUMAN_PROMPT:ft,AI_PROMPT:pt}=dt,{pJ:mt,LG:gt,xX:yt,qA:wt,cH:bt,m_:_t,fK:vt,OE:xt,v7:St,v3:Rt,PO:At,Ll:kt,Is:Et}=t;!function(e){e.Completions=le,e.Messages=Ne,e.Beta=ut}(dt||(dt={}));const Pt=dt,Ct="4.67.1";let It,Ot,$t,Mt,Tt,jt,Nt,Bt,qt,Dt=!1,Lt=null,Ut=null,Wt=null,Ft=null;class Xt{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}It||function(e,t={auto:!1}){if(Dt)throw new Error(`you must \`import 'openai/shims/${e.kind}'\` before importing anything else from openai`);if(It)throw new Error(`can't \`import 'openai/shims/${e.kind}'\` after \`import 'openai/shims/${It}'\``);Dt=t.auto,It=e.kind,Ot=e.fetch,Lt=e.Request,Ut=e.Response,Wt=e.Headers,$t=e.FormData,Ft=e.Blob,Mt=e.File,Tt=e.ReadableStream,jt=e.getMultipartRequestOptions,Nt=e.getDefaultAgent,Bt=e.fileFromPath,qt=e.isFsReadStream}(function({manuallyImported:e}={}){const t=e?"You may need to use polyfills":"Add one of these imports before your first `import â€¦ from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let s,n,r,o;try{s=fetch,n=Request,r=Response,o=Headers}catch(e){throw new Error(`this environment is missing the following Web Fetch API type: ${e.message}. ${t}`)}return{kind:"web",fetch:s,Request:n,Response:r,Headers:o,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${t}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${t}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${t}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${t}`)}},getMultipartRequestOptions:async(e,t)=>({...t,body:new Xt(e)}),getDefaultAgent:e=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:e=>!1}}(),{auto:!0});class Ht{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let s=!1;return new Ht((async function*(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const s of async function*(e,t){if(!e.body)throw t.abort(),new Ts("Attempted to iterate over a response with no body");const s=new Vt,n=new Kt,r=zt(e.body);for await(const e of async function*(e){let t=new Uint8Array;for await(const s of e){if(null==s)continue;const e=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?(new TextEncoder).encode(s):s;let n,r=new Uint8Array(t.length+e.length);for(r.set(t),r.set(e,t.length),t=r;-1!==(n=Jt(t));)yield t.slice(0,n),t=t.slice(n)}t.length>0&&(yield t)}(r))for(const t of n.decode(e)){const e=s.decode(t);e&&(yield e)}for(const e of n.flush()){const t=s.decode(e);t&&(yield t)}}(e,t))if(!n)if(s.data.startsWith("[DONE]"))n=!0;else if(null===s.event){let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if(e&&e.error)throw new js(void 0,e.error,void 0,void 0);yield e}else{let e;try{e=JSON.parse(s.data)}catch(e){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),e}if("error"==s.event)throw new js(void 0,e.error,e.message,void 0);yield{event:s.event,data:e}}n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}}),t)}static fromReadableStream(e,t){let s=!1;return new Ht((async function*(){if(s)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let n=!1;try{for await(const t of async function*(){const t=new Kt,s=zt(e);for await(const e of s)for(const s of t.decode(e))yield s;for(const e of t.flush())yield e}())n||t&&(yield JSON.parse(t));n=!0}catch(e){if(e instanceof Error&&"AbortError"===e.name)return;throw e}finally{n||t.abort()}}),t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],s=this.iterator(),n=n=>({next:()=>{if(0===n.length){const n=s.next();e.push(n),t.push(n)}return n.shift()}});return[new Ht((()=>n(e)),this.controller),new Ht((()=>n(t)),this.controller)]}toReadableStream(){const e=this;let t;const s=new TextEncoder;return new Tt({async start(){t=e[Symbol.asyncIterator]()},async pull(e){try{const{value:n,done:r}=await t.next();if(r)return e.close();const o=s.encode(JSON.stringify(n)+"\n");e.enqueue(o)}catch(t){e.error(t)}},async cancel(){await(t.return?.())}})}}function Jt(e){for(let t=0;t<e.length-2;t++){if(10===e[t]&&10===e[t+1])return t+2;if(13===e[t]&&13===e[t+1])return t+2;if(13===e[t]&&10===e[t+1]&&t+3<e.length&&13===e[t+2]&&10===e[t+3])return t+4}return-1}class Vt{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const e={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],e}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,s,n]=function(e){const t=e.indexOf(":");return-1!==t?[e.substring(0,t),":",e.substring(t+1)]:[e,"",""]}(e);return n.startsWith(" ")&&(n=n.substring(1)),"event"===t?this.event=n:"data"===t&&this.data.push(n),null}}class Kt{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const s=Kt.NEWLINE_CHARS.has(t[t.length-1]||"");let n=t.split(Kt.NEWLINE_REGEXP);return s&&n.pop(),1!==n.length||s?(this.buffer.length>0&&(n=[this.buffer.join("")+n[0],...n.slice(1)],this.buffer=[]),s||(this.buffer=[n.pop()||""]),n):(this.buffer.push(n[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if("undefined"!=typeof Buffer){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new Ts(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new Ts(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new Ts("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function zt(e){if(e[Symbol.asyncIterator])return e;const t=e.getReader();return{async next(){try{const e=await t.read();return e?.done&&t.releaseLock(),e}catch(e){throw t.releaseLock(),e}},async return(){const e=t.cancel();return t.releaseLock(),await e,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}Kt.NEWLINE_CHARS=new Set(["\n","\r"]),Kt.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const Qt=e=>null!=e&&"object"==typeof e&&"string"==typeof e.url&&"function"==typeof e.blob,Gt=e=>null!=e&&"object"==typeof e&&"string"==typeof e.name&&"number"==typeof e.lastModified&&Yt(e),Yt=e=>null!=e&&"object"==typeof e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.text&&"function"==typeof e.slice&&"function"==typeof e.arrayBuffer;async function Zt(e,t,s){if(e=await e,Gt(e))return e;if(Qt(e)){const n=await e.blob();t||(t=new URL(e.url).pathname.split(/[\\/]/).pop()??"unknown_file");const r=Yt(n)?[await n.arrayBuffer()]:[n];return new Mt(r,t,s)}const n=await async function(e){let t=[];if("string"==typeof e||ArrayBuffer.isView(e)||e instanceof ArrayBuffer)t.push(e);else if(Yt(e))t.push(await e.arrayBuffer());else{if(!ts(e))throw new Error(`Unexpected data type: ${typeof e}; constructor: ${e?.constructor?.name}; props: ${function(e){return`[${Object.getOwnPropertyNames(e).map((e=>`"${e}"`)).join(", ")}]`}(e)}`);for await(const s of e)t.push(s)}return t}(e);if(t||(t=function(e){return es(e.name)||es(e.filename)||es(e.path)?.split(/[\\/]/).pop()}(e)??"unknown_file"),!s?.type){const e=n[0]?.type;"string"==typeof e&&(s={...s,type:e})}return new Mt(n,t,s)}const es=e=>"string"==typeof e?e:"undefined"!=typeof Buffer&&e instanceof Buffer?String(e):void 0,ts=e=>null!=e&&"object"==typeof e&&"function"==typeof e[Symbol.asyncIterator],ss=e=>e&&"object"==typeof e&&e.body&&"MultipartBody"===e[Symbol.toStringTag],ns=async e=>{const t=await rs(e.body);return jt(t,e)},rs=async e=>{const t=new $t;return await Promise.all(Object.entries(e||{}).map((([e,s])=>os(t,e,s)))),t},os=async(e,t,s)=>{if(void 0!==s){if(null==s)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)e.append(t,String(s));else if((e=>Gt(e)||Qt(e)||qt(e))(s)){const n=await Zt(s);e.append(t,n)}else if(Array.isArray(s))await Promise.all(s.map((s=>os(e,t+"[]",s))));else{if("object"!=typeof s)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`);await Promise.all(Object.entries(s).map((([s,n])=>os(e,`${t}[${s}]`,n))))}}};var is;async function as(e){const{response:t}=e;if(e.options.stream)return Is("response",t.status,t.url,t.headers,t.body),e.options.__streamClass?e.options.__streamClass.fromSSEResponse(t,e.controller):Ht.fromSSEResponse(t,e.controller);if(204===t.status)return null;if(e.options.__binaryResponse)return t;const s=t.headers.get("content-type");if(s?.includes("application/json")||s?.includes("application/vnd.api+json")){const e=await t.json();return Is("response",t.status,t.url,t.headers,e),cs(e,t)}const n=await t.text();return Is("response",t.status,t.url,t.headers,n),n}function cs(e,t){return!e||"object"!=typeof e||Array.isArray(e)?e:Object.defineProperty(e,"_request_id",{value:t.headers.get("x-request-id"),enumerable:!1})}class ls extends Promise{constructor(e,t=as){super((e=>{e(null)})),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){return new ls(this.responsePromise,(async t=>cs(e(await this.parseResponse(t)),t.response)))}asResponse(){return this.responsePromise.then((e=>e.response))}async withResponse(){const[e,t]=await Promise.all([this.parse(),this.asResponse()]);return{data:e,response:t,request_id:t.headers.get("x-request-id")}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class us{constructor({baseURL:e,maxRetries:t=2,timeout:s=6e5,httpAgent:n,fetch:r}){this.baseURL=e,this.maxRetries=Rs("maxRetries",t),this.timeout=Rs("timeout",s),this.httpAgent=n,this.fetch=r??Ot}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...bs(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Os()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,s){return this.request(Promise.resolve(s).then((async s=>{const n=s&&Yt(s?.body)?new DataView(await s.body.arrayBuffer()):s?.body instanceof DataView?s.body:s?.body instanceof ArrayBuffer?new DataView(s.body):s&&ArrayBuffer.isView(s?.body)?new DataView(s.body.buffer):s?.body;return{method:e,path:t,...s,body:n}})))}getAPIList(e,t,s){return this.requestAPIList(t,{method:"get",path:e,...s})}calculateContentLength(e){if("string"==typeof e){if("undefined"!=typeof Buffer)return Buffer.byteLength(e,"utf8").toString();if("undefined"!=typeof TextEncoder)return(new TextEncoder).encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e,{retryCount:t=0}={}){const{method:s,path:n,query:r,headers:o={}}=e,i=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:ss(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,a=this.calculateContentLength(i),c=this.buildURL(n,r);"timeout"in e&&Rs("timeout",e.timeout);const l=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??Nt(c),h=l+1e3;return"number"==typeof u?.options?.timeout&&h>(u.options.timeout??0)&&(u.options.timeout=h),this.idempotencyHeader&&"get"!==s&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),o[this.idempotencyHeader]=e.idempotencyKey),{req:{method:s,...i&&{body:i},headers:this.buildHeaders({options:e,headers:o,contentLength:a,retryCount:t}),...u&&{agent:u},signal:e.signal??null},url:c,timeout:l}}buildHeaders({options:e,headers:t,contentLength:s,retryCount:n}){const r={};return s&&(r["content-length"]=s),Cs(r,this.defaultHeaders(e)),Cs(r,t),ss(e.body)&&"node"!==It&&delete r["content-type"],void 0===$s(t,"x-stainless-retry-count")&&(r["x-stainless-retry-count"]=String(n)),this.validateHeaders(r,t),r}async prepareOptions(e){}async prepareRequest(e,{url:t,options:s}){}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map((e=>[...e]))):{...e}:{}}makeStatusError(e,t,s,n){return js.generate(e,t,s,n)}request(e,t=null){return new ls(this.makeRequest(e,t))}async makeRequest(e,t){const s=await e,n=s.maxRetries??this.maxRetries;null==t&&(t=n),await this.prepareOptions(s);const{req:r,url:o,timeout:i}=this.buildRequest(s,{retryCount:n-t});if(await this.prepareRequest(r,{url:o,options:s}),Is("request",o,s,r.headers),s.signal?.aborted)throw new Ns;const a=new AbortController,c=await this.fetchWithTimeout(o,r,i,a).catch(As);if(c instanceof Error){if(s.signal?.aborted)throw new Ns;if(t)return this.retryRequest(s,t);if("AbortError"===c.name)throw new qs;throw new Bs({cause:c})}const l=fs(c.headers);if(!c.ok){if(t&&this.shouldRetry(c))return Is(`response (error; retrying, ${t} attempts remaining)`,c.status,o,l),this.retryRequest(s,t,l);const e=await c.text().catch((e=>As(e).message)),n=_s(e),r=n?void 0:e;throw Is(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,o,l,r),this.makeStatusError(c.status,n,r,l)}return{response:c,options:s,controller:a}}requestAPIList(e,t){const s=this.makeRequest(t,null);return new ds(this,s,e)}buildURL(e,t){const s=xs(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),n=this.defaultQuery();return Es(n)||(t={...n,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(s.search=this.stringifyQuery(t)),s.toString()}stringifyQuery(e){return Object.entries(e).filter((([e,t])=>void 0!==t)).map((([e,t])=>{if("string"==typeof t||"number"==typeof t||"boolean"==typeof t)return`${encodeURIComponent(e)}=${encodeURIComponent(t)}`;if(null===t)return`${encodeURIComponent(e)}=`;throw new Ts(`Cannot stringify type ${typeof t}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)})).join("&")}async fetchWithTimeout(e,t,s,n){const{signal:r,...o}=t||{};r&&r.addEventListener("abort",(()=>n.abort()));const i=setTimeout((()=>n.abort()),s);return this.getRequestClient().fetch.call(void 0,e,{signal:n.signal,...o}).finally((()=>{clearTimeout(i)}))}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}async retryRequest(e,t,s){let n;const r=s?.["retry-after-ms"];if(r){const e=parseFloat(r);Number.isNaN(e)||(n=e)}const o=s?.["retry-after"];if(o&&!n){const e=parseFloat(o);n=Number.isNaN(e)?Date.parse(o)-Date.now():1e3*e}if(!(n&&0<=n&&n<6e4)){const s=e.maxRetries??this.maxRetries;n=this.calculateDefaultRetryTimeoutMillis(t,s)}return await Ss(n),this.makeRequest(e,t-1)}calculateDefaultRetryTimeoutMillis(e,t){const s=t-e;return Math.min(.5*Math.pow(2,s),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${Ct}`}}class hs{constructor(e,t,s,n){is.set(this,void 0),function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");"a"===n?r.call(e,s):r?r.value=s:t.set(e,s)}(this,is,e,"f"),this.options=n,this.response=t,this.body=s}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}async getNextPage(){const e=this.nextPageInfo();if(!e)throw new Ts("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const t={...this.options};if("params"in e&&"object"==typeof t.query)t.query={...t.query,...e.params};else if("url"in e){const s=[...Object.entries(t.query||{}),...e.url.searchParams.entries()];for(const[t,n]of s)e.url.searchParams.set(t,n);t.query=void 0,t.path=e.url.toString()}return await function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)}(this,is,"f").requestAPIList(this.constructor,t)}async*iterPages(){let e=this;for(yield e;e.hasNextPage();)e=await e.getNextPage(),yield e}async*[(is=new WeakMap,Symbol.asyncIterator)](){for await(const e of this.iterPages())for(const t of e.getPaginatedItems())yield t}}class ds extends ls{constructor(e,t,s){super(t,(async t=>new s(e,t.response,await as(t),t.options)))}async*[Symbol.asyncIterator](){const e=await(this);for await(const t of e)yield t}}const fs=e=>new Proxy(Object.fromEntries(e.entries()),{get(e,t){const s=t.toString();return e[s.toLowerCase()]||e[s]}}),ps={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},ms=e=>"object"==typeof e&&null!==e&&!Es(e)&&Object.keys(e).every((e=>Ps(ps,e))),gs=e=>"x32"===e?"x32":"x86_64"===e||"x64"===e?"x64":"arm"===e?"arm":"aarch64"===e||"arm64"===e?"arm64":e?`other:${e}`:"unknown",ys=e=>(e=e.toLowerCase()).includes("ios")?"iOS":"android"===e?"Android":"darwin"===e?"MacOS":"win32"===e?"Windows":"freebsd"===e?"FreeBSD":"openbsd"===e?"OpenBSD":"linux"===e?"Linux":e?`Other:${e}`:"Unknown";let ws;const bs=()=>ws??(ws=(()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ct,"X-Stainless-OS":ys(Deno.build.os),"X-Stainless-Arch":gs(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ct,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call("undefined"!=typeof process?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ct,"X-Stainless-OS":ys(process.platform),"X-Stainless-Arch":gs(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const e=function(){if("undefined"==typeof navigator||!navigator)return null;const e=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:t,pattern:s}of e){const e=s.exec(navigator.userAgent);if(e)return{browser:t,version:`${e[1]||0}.${e[2]||0}.${e[3]||0}`}}return null}();return e?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ct,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${e.browser}`,"X-Stainless-Runtime-Version":e.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":Ct,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),_s=e=>{try{return JSON.parse(e)}catch(e){return}},vs=new RegExp("^(?:[a-z]+:)?//","i"),xs=e=>vs.test(e),Ss=e=>new Promise((t=>setTimeout(t,e))),Rs=(e,t)=>{if("number"!=typeof t||!Number.isInteger(t))throw new Ts(`${e} must be an integer`);if(t<0)throw new Ts(`${e} must be a positive integer`);return t},As=e=>{if(e instanceof Error)return e;if("object"==typeof e&&null!==e)try{return new Error(JSON.stringify(e))}catch{}return new Error(e)},ks=e=>"undefined"!=typeof process?process.env?.[e]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(e)?.trim():void 0;function Es(e){if(!e)return!0;for(const t in e)return!1;return!0}function Ps(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Cs(e,t){for(const s in t){if(!Ps(t,s))continue;const n=s.toLowerCase();if(!n)continue;const r=t[s];null===r?delete e[n]:void 0!==r&&(e[n]=r)}}function Is(e,...t){"undefined"!=typeof process&&"true"===process?.env?.DEBUG&&console.log(`OpenAI:DEBUG:${e}`,...t)}const Os=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(e=>{const t=16*Math.random()|0;return("x"===e?t:3&t|8).toString(16)})),$s=(e,t)=>{const s=t.toLowerCase();if((e=>"function"==typeof e?.get)(e)){const n=t[0]?.toUpperCase()+t.substring(1).replace(/([^\w])(\w)/g,((e,t,s)=>t+s.toUpperCase()));for(const r of[t,s,t.toUpperCase(),n]){const t=e.get(r);if(t)return t}}for(const[n,r]of Object.entries(e))if(n.toLowerCase()===s)return Array.isArray(r)?(r.length<=1||console.warn(`Received ${r.length} entries for the ${t} header, using the first entry.`),r[0]):r};function Ms(e){return null!=e&&"object"==typeof e&&!Array.isArray(e)}class Ts extends Error{}class js extends Ts{constructor(e,t,s,n){super(`${js.makeMessage(e,t,s)}`),this.status=e,this.headers=n,this.request_id=n?.["x-request-id"];const r=t;this.error=r,this.code=r?.code,this.param=r?.param,this.type=r?.type}static makeMessage(e,t,s){const n=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):s;return e&&n?`${e} ${n}`:e?`${e} status code (no body)`:n||"(no status code or body)"}static generate(e,t,s,n){if(!e)return new Bs({message:s,cause:As(t)});const r=t?.error;return 400===e?new Ds(e,r,s,n):401===e?new Ls(e,r,s,n):403===e?new Us(e,r,s,n):404===e?new Ws(e,r,s,n):409===e?new Fs(e,r,s,n):422===e?new Xs(e,r,s,n):429===e?new Hs(e,r,s,n):e>=500?new Js(e,r,s,n):new js(e,r,s,n)}}class Ns extends js{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class Bs extends js{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class qs extends Bs{constructor({message:e}={}){super({message:e??"Request timed out."})}}class Ds extends js{constructor(){super(...arguments),this.status=400}}class Ls extends js{constructor(){super(...arguments),this.status=401}}class Us extends js{constructor(){super(...arguments),this.status=403}}class Ws extends js{constructor(){super(...arguments),this.status=404}}class Fs extends js{constructor(){super(...arguments),this.status=409}}class Xs extends js{constructor(){super(...arguments),this.status=422}}class Hs extends js{constructor(){super(...arguments),this.status=429}}class Js extends js{}class Vs extends Ts{constructor(){super("Could not parse response content as the length limit was reached")}}class Ks extends Ts{constructor(){super("Could not parse response content as the request was rejected by the content filter")}}const zs="RFC3986",Qs={RFC1738:e=>String(e).replace(/%20/g,"+"),RFC3986:e=>String(e)},Gs=(Object.prototype.hasOwnProperty,Array.isArray),Ys=(()=>{const e=[];for(let t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e})(),Zs=1024;function en(e,t){if(Gs(e)){const s=[];for(let n=0;n<e.length;n+=1)s.push(t(e[n]));return s}return t(e)}const tn=Object.prototype.hasOwnProperty,sn={brackets:e=>String(e)+"[]",comma:"comma",indices:(e,t)=>String(e)+"["+t+"]",repeat:e=>String(e)},nn=Array.isArray,rn=Array.prototype.push,on=function(e,t){rn.apply(e,nn(t)?t:[t])},an=Date.prototype.toISOString,cn={addQueryPrefix:!1,allowDots:!1,allowEmptyArrays:!1,arrayFormat:"indices",charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encodeDotInKeys:!1,encoder:(e,t,s,n,r)=>{if(0===e.length)return e;let o=e;if("symbol"==typeof e?o=Symbol.prototype.toString.call(e):"string"!=typeof e&&(o=String(e)),"iso-8859-1"===s)return escape(o).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));let i="";for(let e=0;e<o.length;e+=Zs){const t=o.length>=Zs?o.slice(e,e+Zs):o,s=[];for(let e=0;e<t.length;++e){let n=t.charCodeAt(e);45===n||46===n||95===n||126===n||n>=48&&n<=57||n>=65&&n<=90||n>=97&&n<=122||"RFC1738"===r&&(40===n||41===n)?s[s.length]=t.charAt(e):n<128?s[s.length]=Ys[n]:n<2048?s[s.length]=Ys[192|n>>6]+Ys[128|63&n]:n<55296||n>=57344?s[s.length]=Ys[224|n>>12]+Ys[128|n>>6&63]+Ys[128|63&n]:(e+=1,n=65536+((1023&n)<<10|1023&t.charCodeAt(e)),s[s.length]=Ys[240|n>>18]+Ys[128|n>>12&63]+Ys[128|n>>6&63]+Ys[128|63&n])}i+=s.join("")}return i},encodeValuesOnly:!1,format:zs,formatter:Qs[zs],indices:!1,serializeDate:e=>an.call(e),skipNulls:!1,strictNullHandling:!1},ln={};function un(e,t,s,n,r,o,i,a,c,l,u,h,d,f,p,m,g,y){let w=e,b=y,_=0,v=!1;for(;void 0!==(b=b.get(ln))&&!v;){const t=b.get(e);if(_+=1,void 0!==t){if(t===_)throw new RangeError("Cyclic object value");v=!0}void 0===b.get(ln)&&(_=0)}if("function"==typeof l?w=l(t,w):w instanceof Date?w=d?.(w):"comma"===s&&nn(w)&&(w=en(w,(function(e){return e instanceof Date?d?.(e):e}))),null===w){if(o)return c&&!m?c(t,cn.encoder,g,"key",f):t;w=""}if("string"==typeof(x=w)||"number"==typeof x||"boolean"==typeof x||"symbol"==typeof x||"bigint"==typeof x||function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))}(w)){if(c){const e=m?t:c(t,cn.encoder,g,"key",f);return[p?.(e)+"="+p?.(c(w,cn.encoder,g,"value",f))]}return[p?.(t)+"="+p?.(String(w))]}var x;const S=[];if(void 0===w)return S;let R;if("comma"===s&&nn(w))m&&c&&(w=en(w,c)),R=[{value:w.length>0?w.join(",")||null:void 0}];else if(nn(l))R=l;else{const e=Object.keys(w);R=u?e.sort(u):e}const A=a?String(t).replace(/\./g,"%2E"):String(t),k=n&&nn(w)&&1===w.length?A+"[]":A;if(r&&nn(w)&&0===w.length)return k+"[]";for(let t=0;t<R.length;++t){const b=R[t],v="object"==typeof b&&void 0!==b.value?b.value:w[b];if(i&&null===v)continue;const x=h&&a?b.replace(/\./g,"%2E"):b,A=nn(w)?"function"==typeof s?s(k,x):k:k+(h?"."+x:"["+x+"]");y.set(e,_);const E=new WeakMap;E.set(ln,y),on(S,un(v,A,s,n,r,o,i,a,"comma"===s&&m&&nn(w)?null:c,l,u,h,d,f,p,m,g,E))}return S}class hn extends hs{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class dn extends hs{constructor(e,t,s,n){super(e,t,s,n),this.data=s.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class fn{constructor(e){this._client=e}}class pn extends fn{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}pn||(pn={});class mn extends fn{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}mn||(mn={});class gn extends fn{constructor(){super(...arguments),this.completions=new mn(this._client)}}!function(e){e.Completions=mn}(gn||(gn={}));class yn extends fn{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}yn||(yn={});class wn extends fn{create(e,t){return this._client.post("/files",ns({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return ms(e)?this.list({},e):this._client.getAPIList("/files",bn,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}async waitForProcessing(e,{pollInterval:t=5e3,maxWait:s=18e5}={}){const n=new Set(["processed","error","deleted"]),r=Date.now();let o=await this.retrieve(e);for(;!o.status||!n.has(o.status);)if(await Ss(t),o=await this.retrieve(e),Date.now()-r>s)throw new qs({message:`Giving up on waiting for file ${e} to finish processing after ${s} milliseconds.`});return o}}class bn extends hn{}!function(e){e.FileObjectsPage=bn}(wn||(wn={}));class _n extends fn{createVariation(e,t){return this._client.post("/images/variations",ns({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",ns({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}_n||(_n={});class vn extends fn{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}vn||(vn={});class xn extends fn{create(e,t){return this._client.post("/audio/transcriptions",ns({body:e,...t}))}}xn||(xn={});class Sn extends fn{create(e,t){return this._client.post("/audio/translations",ns({body:e,...t}))}}Sn||(Sn={});class Rn extends fn{constructor(){super(...arguments),this.transcriptions=new xn(this._client),this.translations=new Sn(this._client),this.speech=new vn(this._client)}}!function(e){e.Transcriptions=xn,e.Translations=Sn,e.Speech=vn}(Rn||(Rn={}));class An extends fn{create(e,t){return this._client.post("/moderations",{body:e,...t})}}An||(An={});class kn extends fn{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",En,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class En extends hn{}!function(e){e.ModelsPage=En}(kn||(kn={}));class Pn extends fn{list(e,t={},s){return ms(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,Cn,{query:t,...s})}}class Cn extends dn{}!function(e){e.FineTuningJobCheckpointsPage=Cn}(Pn||(Pn={}));class In extends fn{constructor(){super(...arguments),this.checkpoints=new Pn(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return ms(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",On,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},s){return ms(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,$n,{query:t,...s})}}class On extends dn{}class $n extends dn{}!function(e){e.FineTuningJobsPage=On,e.FineTuningJobEventsPage=$n,e.Checkpoints=Pn,e.FineTuningJobCheckpointsPage=Cn}(In||(In={}));class Mn extends fn{constructor(){super(...arguments),this.jobs=new In(this._client)}}!function(e){e.Jobs=In,e.FineTuningJobsPage=On,e.FineTuningJobEventsPage=$n}(Mn||(Mn={}));class Tn extends fn{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/assistants/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e={},t){return ms(e)?this.list({},e):this._client.getAPIList("/assistants",jn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class jn extends dn{}function Nn(e){return"function"==typeof e.parse}!function(e){e.AssistantsPage=jn}(Tn||(Tn={}));const Bn=e=>"assistant"===e?.role,qn=e=>"function"===e?.role,Dn=e=>"tool"===e?.role;var Ln,Un,Wn,Fn,Xn,Hn,Jn,Vn,Kn,zn,Qn,Gn,Yn,Zn=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s},er=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};class tr{constructor(){Ln.add(this),this.controller=new AbortController,Un.set(this,void 0),Wn.set(this,(()=>{})),Fn.set(this,(()=>{})),Xn.set(this,void 0),Hn.set(this,(()=>{})),Jn.set(this,(()=>{})),Vn.set(this,{}),Kn.set(this,!1),zn.set(this,!1),Qn.set(this,!1),Gn.set(this,!1),Zn(this,Un,new Promise(((e,t)=>{Zn(this,Wn,e,"f"),Zn(this,Fn,t,"f")})),"f"),Zn(this,Xn,new Promise(((e,t)=>{Zn(this,Hn,e,"f"),Zn(this,Jn,t,"f")})),"f"),er(this,Un,"f").catch((()=>{})),er(this,Xn,"f").catch((()=>{}))}_run(e){setTimeout((()=>{e().then((()=>{this._emitFinal(),this._emit("end")}),er(this,Ln,"m",Yn).bind(this))}),0)}_connected(){this.ended||(er(this,Wn,"f").call(this),this._emit("connect"))}get ended(){return er(this,Kn,"f")}get errored(){return er(this,zn,"f")}get aborted(){return er(this,Qn,"f")}abort(){this.controller.abort()}on(e,t){return(er(this,Vn,"f")[e]||(er(this,Vn,"f")[e]=[])).push({listener:t}),this}off(e,t){const s=er(this,Vn,"f")[e];if(!s)return this;const n=s.findIndex((e=>e.listener===t));return n>=0&&s.splice(n,1),this}once(e,t){return(er(this,Vn,"f")[e]||(er(this,Vn,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise(((t,s)=>{Zn(this,Gn,!0,"f"),"error"!==e&&this.once("error",s),this.once(e,t)}))}async done(){Zn(this,Gn,!0,"f"),await er(this,Xn,"f")}_emit(e,...t){if(er(this,Kn,"f"))return;"end"===e&&(Zn(this,Kn,!0,"f"),er(this,Hn,"f").call(this));const s=er(this,Vn,"f")[e];if(s&&(er(this,Vn,"f")[e]=s.filter((e=>!e.once)),s.forEach((({listener:e})=>e(...t)))),"abort"===e){const e=t[0];return er(this,Gn,"f")||s?.length||Promise.reject(e),er(this,Fn,"f").call(this,e),er(this,Jn,"f").call(this,e),void this._emit("end")}if("error"===e){const e=t[0];er(this,Gn,"f")||s?.length||Promise.reject(e),er(this,Fn,"f").call(this,e),er(this,Jn,"f").call(this,e),this._emit("end")}}_emitFinal(){}}function sr(e){return"auto-parseable-response-format"===e?.$brand}function nr(e){return"auto-parseable-tool"===e?.$brand}function rr(e,t){const s=e.choices.map((e=>{if("length"===e.finish_reason)throw new Vs;if("content_filter"===e.finish_reason)throw new Ks;return{...e,message:{...e.message,tool_calls:e.message.tool_calls?.map((e=>function(e,t){const s=e.tools?.find((e=>e.function?.name===t.function.name));return{...t,function:{...t.function,parsed_arguments:nr(s)?s.$parseRaw(t.function.arguments):s?.function.strict?JSON.parse(t.function.arguments):null}}}(t,e)))??[],parsed:e.message.content&&!e.message.refusal?or(t,e.message.content):null}}}));return{...e,choices:s}}function or(e,t){return"json_schema"!==e.response_format?.type?null:"json_schema"===e.response_format?.type?"$parseRaw"in e.response_format?e.response_format.$parseRaw(t):JSON.parse(t):null}function ir(e,t){if(!e)return!1;const s=e.tools?.find((e=>e.function?.name===t.function.name));return nr(s)||s?.function.strict||!1}function ar(e){return!!sr(e.response_format)||(e.tools?.some((e=>nr(e)||"function"===e.type&&!0===e.function.strict))??!1)}Un=new WeakMap,Wn=new WeakMap,Fn=new WeakMap,Xn=new WeakMap,Hn=new WeakMap,Jn=new WeakMap,Vn=new WeakMap,Kn=new WeakMap,zn=new WeakMap,Qn=new WeakMap,Gn=new WeakMap,Ln=new WeakSet,Yn=function(e){if(Zn(this,zn,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new Ns),e instanceof Ns)return Zn(this,Qn,!0,"f"),this._emit("abort",e);if(e instanceof Ts)return this._emit("error",e);if(e instanceof Error){const t=new Ts(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new Ts(String(e)))};var cr,lr,ur,hr,dr,fr,pr,mr,gr=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};const yr=10;class wr extends tr{constructor(){super(...arguments),cr.add(this),this._chatCompletions=[],this.messages=[]}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(qn(e)||Dn(e))&&e.content)this._emit("functionCallResult",e.content);else if(Bn(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(Bn(e)&&e.tool_calls)for(const t of e.tool_calls)"function"===t.type&&this._emit("functionCall",t.function)}async finalChatCompletion(){await this.done();const e=this._chatCompletions[this._chatCompletions.length-1];if(!e)throw new Ts("stream ended without producing a ChatCompletion");return e}async finalContent(){return await this.done(),gr(this,cr,"m",lr).call(this)}async finalMessage(){return await this.done(),gr(this,cr,"m",ur).call(this)}async finalFunctionCall(){return await this.done(),gr(this,cr,"m",hr).call(this)}async finalFunctionCallResult(){return await this.done(),gr(this,cr,"m",dr).call(this)}async totalUsage(){return await this.done(),gr(this,cr,"m",fr).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=gr(this,cr,"m",ur).call(this);t&&this._emit("finalMessage",t);const s=gr(this,cr,"m",lr).call(this);s&&this._emit("finalContent",s);const n=gr(this,cr,"m",hr).call(this);n&&this._emit("finalFunctionCall",n);const r=gr(this,cr,"m",dr).call(this);null!=r&&this._emit("finalFunctionCallResult",r),this._chatCompletions.some((e=>e.usage))&&this._emit("totalUsage",gr(this,cr,"m",fr).call(this))}async _createChatCompletion(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),gr(this,cr,"m",pr).call(this,t);const r=await e.chat.completions.create({...t,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(rr(r,t))}async _runChatCompletion(e,t,s){for(const e of t.messages)this._addMessage(e,!1);return await this._createChatCompletion(e,t,s)}async _runFunctions(e,t,s){const n="function",{function_call:r="auto",stream:o,...i}=t,a="string"!=typeof r&&r?.name,{maxChatCompletions:c=yr}=s||{},l={};for(const e of t.functions)l[e.name||e.function.name]=e;const u=t.functions.map((e=>({name:e.name||e.function.name,parameters:e.parameters,description:e.description})));for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...i,function_call:r,functions:u,messages:[...this.messages]},s),o=t.choices[0]?.message;if(!o)throw new Ts("missing message in ChatCompletion response");if(!o.function_call)return;const{name:c,arguments:h}=o.function_call,d=l[c];if(!d){const e=`Invalid function_call: ${JSON.stringify(c)}. Available options are: ${u.map((e=>JSON.stringify(e.name))).join(", ")}. Please try again`;this._addMessage({role:n,name:c,content:e});continue}if(a&&a!==c){const e=`Invalid function_call: ${JSON.stringify(c)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:n,name:c,content:e});continue}let f;try{f=Nn(d)?await d.parse(h):h}catch(e){this._addMessage({role:n,name:c,content:e instanceof Error?e.message:String(e)});continue}const p=await d.function(f,this),m=gr(this,cr,"m",mr).call(this,p);if(this._addMessage({role:n,name:c,content:m}),a)return}}async _runTools(e,t,s){const n="tool",{tool_choice:r="auto",stream:o,...i}=t,a="string"!=typeof r&&r?.function?.name,{maxChatCompletions:c=yr}=s||{},l=t.tools.map((e=>{if(nr(e)){if(!e.$callback)throw new Ts("Tool given to `.runTools()` that does not have an associated function");return{type:"function",function:{function:e.$callback,name:e.function.name,description:e.function.description||"",parameters:e.function.parameters,parse:e.$parseRaw,strict:!0}}}return e})),u={};for(const e of l)"function"===e.type&&(u[e.function.name||e.function.function.name]=e.function);const h="tools"in t?l.map((e=>"function"===e.type?{type:"function",function:{name:e.function.name||e.function.function.name,parameters:e.function.parameters,description:e.function.description,strict:e.function.strict}}:e)):void 0;for(const e of t.messages)this._addMessage(e,!1);for(let t=0;t<c;++t){const t=await this._createChatCompletion(e,{...i,tool_choice:r,tools:h,messages:[...this.messages]},s),o=t.choices[0]?.message;if(!o)throw new Ts("missing message in ChatCompletion response");if(!o.tool_calls?.length)return;for(const e of o.tool_calls){if("function"!==e.type)continue;const t=e.id,{name:s,arguments:r}=e.function,o=u[s];if(!o){const e=`Invalid tool_call: ${JSON.stringify(s)}. Available options are: ${Object.keys(u).map((e=>JSON.stringify(e))).join(", ")}. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}if(a&&a!==s){const e=`Invalid tool_call: ${JSON.stringify(s)}. ${JSON.stringify(a)} requested. Please try again`;this._addMessage({role:n,tool_call_id:t,content:e});continue}let i;try{i=Nn(o)?await o.parse(r):r}catch(e){const s=e instanceof Error?e.message:String(e);this._addMessage({role:n,tool_call_id:t,content:s});continue}const c=await o.function(i,this),l=gr(this,cr,"m",mr).call(this,c);if(this._addMessage({role:n,tool_call_id:t,content:l}),a)return}}}}cr=new WeakSet,lr=function(){return gr(this,cr,"m",ur).call(this).content??null},ur=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(Bn(t)){const{function_call:e,...s}=t,n={...s,content:t.content??null,refusal:t.refusal??null};return e&&(n.function_call=e),n}}throw new Ts("stream ended without producing a ChatCompletionMessage with role=assistant")},hr=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Bn(t)&&t?.function_call)return t.function_call;if(Bn(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},dr=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(qn(t)&&null!=t.content)return t.content;if(Dn(t)&&null!=t.content&&"string"==typeof t.content&&this.messages.some((e=>"assistant"===e.role&&e.tool_calls?.some((e=>"function"===e.type&&e.id===t.tool_call_id)))))return t.content}},fr=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},pr=function(e){if(null!=e.n&&e.n>1)throw new Ts("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},mr=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class br extends wr{static runFunctions(e,t,s){const n=new br,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run((()=>n._runFunctions(e,t,r))),n}static runTools(e,t,s){const n=new br,r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run((()=>n._runTools(e,t,r))),n}_addMessage(e,t=!0){super._addMessage(e,t),Bn(e)&&e.content&&this._emit("content",e.content)}}class _r extends Error{}class vr extends Error{}const xr=e=>function(e,t=511){if("string"!=typeof e)throw new TypeError("expecting str, got "+typeof e);if(!e.trim())throw new Error(`${e} is empty`);return((e,t)=>{const s=e.length;let n=0;const r=e=>{throw new _r(`${e} at position ${n}`)},o=e=>{throw new vr(`${e} at position ${n}`)},i=()=>(h(),n>=s&&r("Unexpected end of input"),'"'===e[n]?a():"{"===e[n]?c():"["===e[n]?l():"null"===e.substring(n,n+4)||16&t&&s-n<4&&"null".startsWith(e.substring(n))?(n+=4,null):"true"===e.substring(n,n+4)||32&t&&s-n<4&&"true".startsWith(e.substring(n))?(n+=4,!0):"false"===e.substring(n,n+5)||32&t&&s-n<5&&"false".startsWith(e.substring(n))?(n+=5,!1):"Infinity"===e.substring(n,n+8)||128&t&&s-n<8&&"Infinity".startsWith(e.substring(n))?(n+=8,1/0):"-Infinity"===e.substring(n,n+9)||256&t&&1<s-n&&s-n<9&&"-Infinity".startsWith(e.substring(n))?(n+=9,-1/0):"NaN"===e.substring(n,n+3)||64&t&&s-n<3&&"NaN".startsWith(e.substring(n))?(n+=3,NaN):u()),a=()=>{const i=n;let a=!1;for(n++;n<s&&('"'!==e[n]||a&&"\\"===e[n-1]);)a="\\"===e[n]&&!a,n++;if('"'==e.charAt(n))try{return JSON.parse(e.substring(i,++n-Number(a)))}catch(e){o(String(e))}else if(1&t)try{return JSON.parse(e.substring(i,n-Number(a))+'"')}catch(t){return JSON.parse(e.substring(i,e.lastIndexOf("\\"))+'"')}r("Unterminated string literal")},c=()=>{n++,h();const o={};try{for(;"}"!==e[n];){if(h(),n>=s&&8&t)return o;const r=a();h(),n++;try{const e=i();Object.defineProperty(o,r,{value:e,writable:!0,enumerable:!0,configurable:!0})}catch(e){if(8&t)return o;throw e}h(),","===e[n]&&n++}}catch(e){if(8&t)return o;r("Expected '}' at end of object")}return n++,o},l=()=>{n++;const s=[];try{for(;"]"!==e[n];)s.push(i()),h(),","===e[n]&&n++}catch(e){if(4&t)return s;r("Expected ']' at end of array")}return n++,s},u=()=>{if(0===n){"-"===e&&2&t&&r("Not sure what '-' is");try{return JSON.parse(e)}catch(s){if(2&t)try{return"."===e[e.length-1]?JSON.parse(e.substring(0,e.lastIndexOf("."))):JSON.parse(e.substring(0,e.lastIndexOf("e")))}catch(e){}o(String(s))}}const i=n;for("-"===e[n]&&n++;e[n]&&!",]}".includes(e[n]);)n++;n!=s||2&t||r("Unterminated number literal");try{return JSON.parse(e.substring(i,n))}catch(s){"-"===e.substring(i,n)&&2&t&&r("Not sure what '-' is");try{return JSON.parse(e.substring(i,e.lastIndexOf("e")))}catch(e){o(String(e))}}},h=()=>{for(;n<s&&" \n\r\t".includes(e[n]);)n++};return i()})(e.trim(),t)}(e,509);var Sr,Rr,Ar,kr,Er,Pr,Cr,Ir,Or,$r,Mr,Tr,jr=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s},Nr=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)};class Br extends wr{constructor(e){super(),Sr.add(this),Rr.set(this,void 0),Ar.set(this,void 0),kr.set(this,void 0),jr(this,Rr,e,"f"),jr(this,Ar,[],"f")}get currentChatCompletionSnapshot(){return Nr(this,kr,"f")}static fromReadableStream(e){const t=new Br(null);return t._run((()=>t._fromReadableStream(e))),t}static createChatCompletion(e,t,s){const n=new Br(t);return n._run((()=>n._runChatCompletion(e,{...t,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),n}async _createChatCompletion(e,t,s){super._createChatCompletion;const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort()))),Nr(this,Sr,"m",Er).call(this);const r=await e.chat.completions.create({...t,stream:!0},{...s,signal:this.controller.signal});this._connected();for await(const e of r)Nr(this,Sr,"m",Cr).call(this,e);if(r.controller.signal?.aborted)throw new Ns;return this._addChatCompletion(Nr(this,Sr,"m",$r).call(this))}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),Nr(this,Sr,"m",Er).call(this),this._connected();const n=Ht.fromReadableStream(e,this.controller);let r;for await(const e of n)r&&r!==e.id&&this._addChatCompletion(Nr(this,Sr,"m",$r).call(this)),Nr(this,Sr,"m",Cr).call(this,e),r=e.id;if(n.controller.signal?.aborted)throw new Ns;return this._addChatCompletion(Nr(this,Sr,"m",$r).call(this))}[(Rr=new WeakMap,Ar=new WeakMap,kr=new WeakMap,Sr=new WeakSet,Er=function(){this.ended||jr(this,kr,void 0,"f")},Pr=function(e){let t=Nr(this,Ar,"f")[e.index];return t||(t={content_done:!1,refusal_done:!1,logprobs_content_done:!1,logprobs_refusal_done:!1,done_tool_calls:new Set,current_tool_call_index:null},Nr(this,Ar,"f")[e.index]=t,t)},Cr=function(e){if(this.ended)return;const t=Nr(this,Sr,"m",Tr).call(this,e);this._emit("chunk",e,t);for(const s of e.choices){const e=t.choices[s.index];null!=s.delta.content&&"assistant"===e.message?.role&&e.message?.content&&(this._emit("content",s.delta.content,e.message.content),this._emit("content.delta",{delta:s.delta.content,snapshot:e.message.content,parsed:e.message.parsed})),null!=s.delta.refusal&&"assistant"===e.message?.role&&e.message?.refusal&&this._emit("refusal.delta",{delta:s.delta.refusal,snapshot:e.message.refusal}),null!=s.logprobs?.content&&"assistant"===e.message?.role&&this._emit("logprobs.content.delta",{content:s.logprobs?.content,snapshot:e.logprobs?.content??[]}),null!=s.logprobs?.refusal&&"assistant"===e.message?.role&&this._emit("logprobs.refusal.delta",{refusal:s.logprobs?.refusal,snapshot:e.logprobs?.refusal??[]});const n=Nr(this,Sr,"m",Pr).call(this,e);e.finish_reason&&(Nr(this,Sr,"m",Or).call(this,e),null!=n.current_tool_call_index&&Nr(this,Sr,"m",Ir).call(this,e,n.current_tool_call_index));for(const t of s.delta.tool_calls??[])n.current_tool_call_index!==t.index&&(Nr(this,Sr,"m",Or).call(this,e),null!=n.current_tool_call_index&&Nr(this,Sr,"m",Ir).call(this,e,n.current_tool_call_index)),n.current_tool_call_index=t.index;for(const t of s.delta.tool_calls??[]){const s=e.message.tool_calls?.[t.index];s?.type&&"function"===s?.type&&this._emit("tool_calls.function.arguments.delta",{name:s.function?.name,index:t.index,arguments:s.function.arguments,parsed_arguments:s.function.parsed_arguments,arguments_delta:t.function?.arguments??""})}}},Ir=function(e,t){if(Nr(this,Sr,"m",Pr).call(this,e).done_tool_calls.has(t))return;const s=e.message.tool_calls?.[t];if(!s)throw new Error("no tool call snapshot");if(!s.type)throw new Error("tool call snapshot missing `type`");if("function"===s.type){const e=Nr(this,Rr,"f")?.tools?.find((e=>"function"===e.type&&e.function.name===s.function.name));this._emit("tool_calls.function.arguments.done",{name:s.function.name,index:t,arguments:s.function.arguments,parsed_arguments:nr(e)?e.$parseRaw(s.function.arguments):e?.function.strict?JSON.parse(s.function.arguments):null})}else s.type},Or=function(e){const t=Nr(this,Sr,"m",Pr).call(this,e);if(e.message.content&&!t.content_done){t.content_done=!0;const s=Nr(this,Sr,"m",Mr).call(this);this._emit("content.done",{content:e.message.content,parsed:s?s.$parseRaw(e.message.content):null})}e.message.refusal&&!t.refusal_done&&(t.refusal_done=!0,this._emit("refusal.done",{refusal:e.message.refusal})),e.logprobs?.content&&!t.logprobs_content_done&&(t.logprobs_content_done=!0,this._emit("logprobs.content.done",{content:e.logprobs.content})),e.logprobs?.refusal&&!t.logprobs_refusal_done&&(t.logprobs_refusal_done=!0,this._emit("logprobs.refusal.done",{refusal:e.logprobs.refusal}))},$r=function(){if(this.ended)throw new Ts("stream has ended, this shouldn't happen");const e=Nr(this,kr,"f");if(!e)throw new Ts("request ended without sending any chunks");return jr(this,kr,void 0,"f"),jr(this,Ar,[],"f"),function(e,t){const{id:s,choices:n,created:r,model:o,system_fingerprint:i,...a}=e,c={...a,id:s,choices:n.map((({message:t,finish_reason:s,index:n,logprobs:r,...o})=>{if(!s)throw new Ts(`missing finish_reason for choice ${n}`);const{content:i=null,function_call:a,tool_calls:c,...l}=t,u=t.role;if(!u)throw new Ts(`missing role for choice ${n}`);if(a){const{arguments:e,name:c}=a;if(null==e)throw new Ts(`missing function_call.arguments for choice ${n}`);if(!c)throw new Ts(`missing function_call.name for choice ${n}`);return{...o,message:{content:i,function_call:{arguments:e,name:c},role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}}return c?{...o,index:n,finish_reason:s,logprobs:r,message:{...l,role:u,content:i,refusal:t.refusal??null,tool_calls:c.map(((t,s)=>{const{function:r,type:o,id:i,...a}=t,{arguments:c,name:l,...u}=r||{};if(null==i)throw new Ts(`missing choices[${n}].tool_calls[${s}].id\n${qr(e)}`);if(null==o)throw new Ts(`missing choices[${n}].tool_calls[${s}].type\n${qr(e)}`);if(null==l)throw new Ts(`missing choices[${n}].tool_calls[${s}].function.name\n${qr(e)}`);if(null==c)throw new Ts(`missing choices[${n}].tool_calls[${s}].function.arguments\n${qr(e)}`);return{...a,id:i,type:o,function:{...u,name:l,arguments:c}}}))}}:{...o,message:{...l,content:i,role:u,refusal:t.refusal??null},finish_reason:s,index:n,logprobs:r}})),created:r,model:o,object:"chat.completion",...i?{system_fingerprint:i}:{}};return function(e,t){return t&&ar(t)?rr(e,t):{...e,choices:e.choices.map((e=>({...e,message:{...e.message,parsed:null,tool_calls:e.message.tool_calls??[]}})))}}(c,t)}(e,Nr(this,Rr,"f"))},Mr=function(){const e=Nr(this,Rr,"f")?.response_format;return sr(e)?e:null},Tr=function(e){var t,s,n,r;let o=Nr(this,kr,"f");const{choices:i,...a}=e;o?Object.assign(o,a):o=jr(this,kr,{...a,choices:[]},"f");for(const{delta:i,finish_reason:a,index:c,logprobs:l=null,...u}of e.choices){let e=o.choices[c];if(e||(e=o.choices[c]={finish_reason:a,index:c,message:{},logprobs:l,...u}),l)if(e.logprobs){const{content:n,refusal:r,...o}=l;Object.assign(e.logprobs,o),n&&((t=e.logprobs).content??(t.content=[]),e.logprobs.content.push(...n)),r&&((s=e.logprobs).refusal??(s.refusal=[]),e.logprobs.refusal.push(...r))}else e.logprobs=Object.assign({},l);if(a&&(e.finish_reason=a,Nr(this,Rr,"f")&&ar(Nr(this,Rr,"f")))){if("length"===a)throw new Vs;if("content_filter"===a)throw new Ks}if(Object.assign(e,u),!i)continue;const{content:h,refusal:d,function_call:f,role:p,tool_calls:m,...g}=i;if(Object.assign(e.message,g),d&&(e.message.refusal=(e.message.refusal||"")+d),p&&(e.message.role=p),f&&(e.message.function_call?(f.name&&(e.message.function_call.name=f.name),f.arguments&&((n=e.message.function_call).arguments??(n.arguments=""),e.message.function_call.arguments+=f.arguments)):e.message.function_call=f),h&&(e.message.content=(e.message.content||"")+h,!e.message.refusal&&Nr(this,Sr,"m",Mr).call(this)&&(e.message.parsed=xr(e.message.content))),m){e.message.tool_calls||(e.message.tool_calls=[]);for(const{index:t,id:s,type:n,function:o,...i}of m){const a=(r=e.message.tool_calls)[t]??(r[t]={});Object.assign(a,i),s&&(a.id=s),n&&(a.type=n),o&&(a.function??(a.function={name:o.name??"",arguments:""})),o?.name&&(a.function.name=o.name),o?.arguments&&(a.function.arguments+=o.arguments,ir(Nr(this,Rr,"f"),a)&&(a.function.parsed_arguments=xr(a.function.arguments)))}}}return o},Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("chunk",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){return new Ht(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function qr(e){return JSON.stringify(e)}class Dr extends Br{static fromReadableStream(e){const t=new Dr(null);return t._run((()=>t._fromReadableStream(e))),t}static runFunctions(e,t,s){const n=new Dr(null),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return n._run((()=>n._runFunctions(e,t,r))),n}static runTools(e,t,s){const n=new Dr(t),r={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return n._run((()=>n._runTools(e,t,r))),n}}class Lr extends fn{parse(e,t){return function(e){for(const t of e??[]){if("function"!==t.type)throw new Ts(`Currently only \`function\` tool types support auto-parsing; Received \`${t.type}\``);if(!0!==t.function.strict)throw new Ts(`The \`${t.function.name}\` tool is not marked with \`strict: true\`. Only strict function tools can be auto-parsed`)}}(e.tools),this._client.chat.completions.create(e,{...t,headers:{...t?.headers,"X-Stainless-Helper-Method":"beta.chat.completions.parse"}})._thenUnwrap((t=>rr(t,e)))}runFunctions(e,t){return e.stream?Dr.runFunctions(this._client,e,t):br.runFunctions(this._client,e,t)}runTools(e,t){return e.stream?Dr.runTools(this._client,e,t):br.runTools(this._client,e,t)}stream(e,t){return Br.createChatCompletion(this._client,e,t)}}class Ur extends fn{constructor(){super(...arguments),this.completions=new Lr(this._client)}}!function(e){e.Completions=Lr}(Ur||(Ur={}));var Wr,Fr,Xr,Hr,Jr,Vr,Kr,zr,Qr,Gr,Yr,Zr,eo,to,so,no,ro,oo,io,ao,co,lo,uo,ho=function(e,t,s,n){if("a"===s&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!n:!t.has(e))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?n:"a"===s?n.call(e):n?n.value:t.get(e)},fo=function(e,t,s,n,r){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!r)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!r:!t.has(e))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?r.call(e,s):r?r.value=s:t.set(e,s),s};class po extends tr{constructor(){super(...arguments),Wr.add(this),Fr.set(this,[]),Xr.set(this,{}),Hr.set(this,{}),Jr.set(this,void 0),Vr.set(this,void 0),Kr.set(this,void 0),zr.set(this,void 0),Qr.set(this,void 0),Gr.set(this,void 0),Yr.set(this,void 0),Zr.set(this,void 0),eo.set(this,void 0)}[(Fr=new WeakMap,Xr=new WeakMap,Hr=new WeakMap,Jr=new WeakMap,Vr=new WeakMap,Kr=new WeakMap,zr=new WeakMap,Qr=new WeakMap,Gr=new WeakMap,Yr=new WeakMap,Zr=new WeakMap,eo=new WeakMap,Wr=new WeakSet,Symbol.asyncIterator)](){const e=[],t=[];let s=!1;return this.on("event",(s=>{const n=t.shift();n?n.resolve(s):e.push(s)})),this.on("end",(()=>{s=!0;for(const e of t)e.resolve(void 0);t.length=0})),this.on("abort",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),this.on("error",(e=>{s=!0;for(const s of t)s.reject(e);t.length=0})),{next:async()=>e.length?{value:e.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise(((e,s)=>t.push({resolve:e,reject:s}))).then((e=>e?{value:e,done:!1}:{value:void 0,done:!0})),return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(e){const t=new po;return t._run((()=>t._fromReadableStream(e))),t}async _fromReadableStream(e,t){const s=t?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",(()=>this.controller.abort()))),this._connected();const n=Ht.fromReadableStream(e,this.controller);for await(const e of n)ho(this,Wr,"m",to).call(this,e);if(n.controller.signal?.aborted)throw new Ns;return this._addRun(ho(this,Wr,"m",so).call(this))}toReadableStream(){return new Ht(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,s,n,r){const o=new po;return o._run((()=>o._runToolAssistantStream(e,t,s,n,{...r,headers:{...r?.headers,"X-Stainless-Helper-Method":"stream"}}))),o}async _createToolAssistantStream(e,t,s,n,r){const o=r?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",(()=>this.controller.abort())));const i={...n,stream:!0},a=await e.submitToolOutputs(t,s,i,{...r,signal:this.controller.signal});this._connected();for await(const e of a)ho(this,Wr,"m",to).call(this,e);if(a.controller.signal?.aborted)throw new Ns;return this._addRun(ho(this,Wr,"m",so).call(this))}static createThreadAssistantStream(e,t,s){const n=new po;return n._run((()=>n._threadAssistantStream(e,t,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}}))),n}static createAssistantStream(e,t,s,n){const r=new po;return r._run((()=>r._runAssistantStream(e,t,s,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}}))),r}currentEvent(){return ho(this,Yr,"f")}currentRun(){return ho(this,Zr,"f")}currentMessageSnapshot(){return ho(this,Jr,"f")}currentRunStepSnapshot(){return ho(this,eo,"f")}async finalRunSteps(){return await this.done(),Object.values(ho(this,Xr,"f"))}async finalMessages(){return await this.done(),Object.values(ho(this,Hr,"f"))}async finalRun(){if(await this.done(),!ho(this,Vr,"f"))throw Error("Final run was not received.");return ho(this,Vr,"f")}async _createThreadAssistantStream(e,t,s){const n=s?.signal;n&&(n.aborted&&this.controller.abort(),n.addEventListener("abort",(()=>this.controller.abort())));const r={...t,stream:!0},o=await e.createAndRun(r,{...s,signal:this.controller.signal});this._connected();for await(const e of o)ho(this,Wr,"m",to).call(this,e);if(o.controller.signal?.aborted)throw new Ns;return this._addRun(ho(this,Wr,"m",so).call(this))}async _createAssistantStream(e,t,s,n){const r=n?.signal;r&&(r.aborted&&this.controller.abort(),r.addEventListener("abort",(()=>this.controller.abort())));const o={...s,stream:!0},i=await e.create(t,o,{...n,signal:this.controller.signal});this._connected();for await(const e of i)ho(this,Wr,"m",to).call(this,e);if(i.controller.signal?.aborted)throw new Ns;return this._addRun(ho(this,Wr,"m",so).call(this))}static accumulateDelta(e,t){for(const[s,n]of Object.entries(t)){if(!e.hasOwnProperty(s)){e[s]=n;continue}let t=e[s];if(null!=t)if("index"!==s&&"type"!==s){if("string"==typeof t&&"string"==typeof n)t+=n;else if("number"==typeof t&&"number"==typeof n)t+=n;else{if(!Ms(t)||!Ms(n)){if(Array.isArray(t)&&Array.isArray(n)){if(t.every((e=>"string"==typeof e||"number"==typeof e))){t.push(...n);continue}for(const e of n){if(!Ms(e))throw new Error(`Expected array delta entry to be an object but got: ${e}`);const s=e.index;if(null==s)throw console.error(e),new Error("Expected array delta entry to have an `index` property");if("number"!=typeof s)throw new Error(`Expected array delta entry \`index\` property to be a number but got ${s}`);const n=t[s];null==n?t.push(e):t[s]=this.accumulateDelta(n,e)}continue}throw Error(`Unhandled record type: ${s}, deltaValue: ${n}, accValue: ${t}`)}t=this.accumulateDelta(t,n)}e[s]=t}else e[s]=n;else e[s]=n}return e}_addRun(e){return e}async _threadAssistantStream(e,t,s){return await this._createThreadAssistantStream(t,e,s)}async _runAssistantStream(e,t,s,n){return await this._createAssistantStream(t,e,s,n)}async _runToolAssistantStream(e,t,s,n,r){return await this._createToolAssistantStream(s,e,t,n,r)}}to=function(e){if(!this.ended)switch(fo(this,Yr,e,"f"),ho(this,Wr,"m",oo).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":ho(this,Wr,"m",lo).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":ho(this,Wr,"m",ro).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":ho(this,Wr,"m",no).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},so=function(){if(this.ended)throw new Ts("stream has ended, this shouldn't happen");if(!ho(this,Vr,"f"))throw Error("Final run has not been received");return ho(this,Vr,"f")},no=function(e){const[t,s]=ho(this,Wr,"m",ao).call(this,e,ho(this,Jr,"f"));fo(this,Jr,t,"f"),ho(this,Hr,"f")[t.id]=t;for(const e of s){const s=t.content[e.index];"text"==s?.type&&this._emit("textCreated",s.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if("text"==s.type&&s.text){let e=s.text,n=t.content[s.index];if(!n||"text"!=n.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",e,n.text)}if(s.index!=ho(this,Kr,"f")){if(ho(this,zr,"f"))switch(ho(this,zr,"f").type){case"text":this._emit("textDone",ho(this,zr,"f").text,ho(this,Jr,"f"));break;case"image_file":this._emit("imageFileDone",ho(this,zr,"f").image_file,ho(this,Jr,"f"))}fo(this,Kr,s.index,"f")}fo(this,zr,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==ho(this,Kr,"f")){const t=e.data.content[ho(this,Kr,"f")];if(t)switch(t.type){case"image_file":this._emit("imageFileDone",t.image_file,ho(this,Jr,"f"));break;case"text":this._emit("textDone",t.text,ho(this,Jr,"f"))}}ho(this,Jr,"f")&&this._emit("messageDone",e.data),fo(this,Jr,void 0,"f")}},ro=function(e){const t=ho(this,Wr,"m",io).call(this,e);switch(fo(this,eo,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const s=e.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const e of s.step_details.tool_calls)e.index==ho(this,Qr,"f")?this._emit("toolCallDelta",e,t.step_details.tool_calls[e.index]):(ho(this,Gr,"f")&&this._emit("toolCallDone",ho(this,Gr,"f")),fo(this,Qr,e.index,"f"),fo(this,Gr,t.step_details.tool_calls[e.index],"f"),ho(this,Gr,"f")&&this._emit("toolCallCreated",ho(this,Gr,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":fo(this,eo,void 0,"f"),"tool_calls"==e.data.step_details.type&&ho(this,Gr,"f")&&(this._emit("toolCallDone",ho(this,Gr,"f")),fo(this,Gr,void 0,"f")),this._emit("runStepDone",e.data,t)}},oo=function(e){ho(this,Fr,"f").push(e),this._emit("event",e)},io=function(e){switch(e.event){case"thread.run.step.created":return ho(this,Xr,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=ho(this,Xr,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let s=e.data;if(s.delta){const n=po.accumulateDelta(t,s.delta);ho(this,Xr,"f")[e.data.id]=n}return ho(this,Xr,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":ho(this,Xr,"f")[e.data.id]=e.data}if(ho(this,Xr,"f")[e.data.id])return ho(this,Xr,"f")[e.data.id];throw new Error("No snapshot available")},ao=function(e,t){let s=[];switch(e.event){case"thread.message.created":return[e.data,s];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let n=e.data;if(n.delta.content)for(const e of n.delta.content)if(e.index in t.content){let s=t.content[e.index];t.content[e.index]=ho(this,Wr,"m",co).call(this,e,s)}else t.content[e.index]=e,s.push(e);return[t,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},co=function(e,t){return po.accumulateDelta(t,e)},lo=function(e){switch(fo(this,Zr,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":fo(this,Vr,e.data,"f"),ho(this,Gr,"f")&&(this._emit("toolCallDone",ho(this,Gr,"f")),fo(this,Gr,void 0,"f"))}};class mo extends fn{create(e,t,s){return this._client.post(`/threads/${e}/messages`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,n){return this._client.post(`/threads/${e}/messages/${t}`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},s){return ms(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,go,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t,s){return this._client.delete(`/threads/${e}/messages/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}}class go extends dn{}!function(e){e.MessagesPage=go}(mo||(mo={}));class yo extends fn{retrieve(e,t,s,n={},r){return ms(n)?this.retrieve(e,t,s,{},n):this._client.get(`/threads/${e}/runs/${t}/steps/${s}`,{query:n,...r,headers:{"OpenAI-Beta":"assistants=v2",...r?.headers}})}list(e,t,s={},n){return ms(s)?this.list(e,t,{},s):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,wo,{query:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class wo extends dn{}!function(e){e.RunStepsPage=wo}(yo||(yo={}));class bo extends fn{constructor(){super(...arguments),this.steps=new yo(this._client)}create(e,t,s){const{include:n,...r}=t;return this._client.post(`/threads/${e}/runs`,{query:{include:n},body:r,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:t.stream??!1})}retrieve(e,t,s){return this._client.get(`/threads/${e}/runs/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(e,t,s,n){return this._client.post(`/threads/${e}/runs/${t}`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},s){return ms(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,_o,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t,s);return await this.poll(e,n.id,s)}createAndStream(e,t,s){return po.createAssistantStream(e,this._client.beta.threads.runs,t,s)}async poll(e,t,s){const n={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:o}=await this.retrieve(e,t,{...s,headers:{...s?.headers,...n}}).withResponse();switch(r.status){case"queued":case"in_progress":case"cancelling":let e=5e3;if(s?.pollIntervalMs)e=s.pollIntervalMs;else{const t=o.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await Ss(e);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return r}}}stream(e,t,s){return po.createAssistantStream(e,this._client.beta.threads.runs,t,s)}submitToolOutputs(e,t,s,n){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(e,t,s,n){const r=await this.submitToolOutputs(e,t,s,n);return await this.poll(e,r.id,n)}submitToolOutputsStream(e,t,s,n){return po.createToolAssistantStream(e,t,this._client.beta.threads.runs,s,n)}}class _o extends dn{}!function(e){e.RunsPage=_o,e.Steps=yo,e.RunStepsPage=wo}(bo||(bo={}));class vo extends fn{constructor(){super(...arguments),this.runs=new bo(this._client),this.messages=new mo(this._client)}create(e={},t){return ms(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/threads/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}async createAndRunPoll(e,t){const s=await this.createAndRun(e,t);return await this.runs.poll(s.thread_id,s.id,t)}createAndRunStream(e,t){return po.createThreadAssistantStream(e,this._client.beta.threads,t)}}!function(e){e.Runs=bo,e.RunsPage=_o,e.Messages=mo,e.MessagesPage=go}(vo||(vo={}));class xo extends fn{create(e,t,s){return this._client.post(`/vector_stores/${e}/files`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},s){return ms(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,So,{query:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(e,t,s){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t,s);return await this.poll(e,n.id,s)}async poll(e,t,s){const n={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const r=await this.retrieve(e,t,{...s,headers:n}).withResponse(),o=r.data;switch(o.status){case"in_progress":let e=5e3;if(s?.pollIntervalMs)e=s.pollIntervalMs;else{const t=r.response.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await Ss(e);break;case"failed":case"completed":return o}}}async upload(e,t,s){const n=await this._client.files.create({file:t,purpose:"assistants"},s);return this.create(e,{file_id:n.id},s)}async uploadAndPoll(e,t,s){const n=await this.upload(e,t,s);return await this.poll(e,n.id,s)}}class So extends dn{}!function(e){e.VectorStoreFilesPage=So}(xo||(xo={}));class Ro extends fn{create(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(e,t,s){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(e,t,s){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(e,t,s){const n=await this.create(e,t);return await this.poll(e,n.id,s)}listFiles(e,t,s={},n){return ms(s)?this.listFiles(e,t,{},s):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,So,{query:s,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}async poll(e,t,s){const n={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(n["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){const{data:r,response:o}=await this.retrieve(e,t,{...s,headers:n}).withResponse();switch(r.status){case"in_progress":let e=5e3;if(s?.pollIntervalMs)e=s.pollIntervalMs;else{const t=o.headers.get("openai-poll-after-ms");if(t){const s=parseInt(t);isNaN(s)||(e=s)}}await Ss(e);break;case"failed":case"cancelled":case"completed":return r}}}async uploadAndPoll(e,{files:t,fileIds:s=[]},n){if(null==t||0==t.length)throw new Error("No `files` provided to process. If you've already uploaded files you should use `.createAndPoll()` instead");const r=n?.maxConcurrency??5,o=Math.min(r,t.length),i=this._client,a=t.values(),c=[...s],l=Array(o).fill(a).map((async function(e){for(let t of e){const e=await i.files.create({file:t,purpose:"assistants"},n);c.push(e.id)}}));return await(async e=>{const t=await Promise.allSettled(e),s=t.filter((e=>"rejected"===e.status));if(s.length){for(const e of s)console.error(e.reason);throw new Error(`${s.length} promise(s) failed - see the above errors`)}const n=[];for(const e of t)"fulfilled"===e.status&&n.push(e.value);return n})(l),await this.createAndPoll(e,{file_ids:c})}}Ro||(Ro={});class Ao extends fn{constructor(){super(...arguments),this.files=new xo(this._client),this.fileBatches=new Ro(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,s){return this._client.post(`/vector_stores/${e}`,{body:t,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e={},t){return ms(e)?this.list({},e):this._client.getAPIList("/vector_stores",ko,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class ko extends dn{}!function(e){e.VectorStoresPage=ko,e.Files=xo,e.VectorStoreFilesPage=So,e.FileBatches=Ro}(Ao||(Ao={}));class Eo extends fn{constructor(){super(...arguments),this.vectorStores=new Ao(this._client),this.chat=new Ur(this._client),this.assistants=new Tn(this._client),this.threads=new vo(this._client)}}!function(e){e.VectorStores=Ao,e.VectorStoresPage=ko,e.Chat=Ur,e.Assistants=Tn,e.AssistantsPage=jn,e.Threads=vo}(Eo||(Eo={}));class Po extends fn{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return ms(e)?this.list({},e):this._client.getAPIList("/batches",Co,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class Co extends dn{}!function(e){e.BatchesPage=Co}(Po||(Po={}));class Io extends fn{create(e,t,s){return this._client.post(`/uploads/${e}/parts`,ns({body:t,...s}))}}Io||(Io={});class Oo extends fn{constructor(){super(...arguments),this.parts=new Io(this._client)}create(e,t){return this._client.post("/uploads",{body:e,...t})}cancel(e,t){return this._client.post(`/uploads/${e}/cancel`,t)}complete(e,t,s){return this._client.post(`/uploads/${e}/complete`,{body:t,...s})}}!function(e){e.Parts=Io}(Oo||(Oo={}));class $o extends us{constructor({baseURL:e=ks("OPENAI_BASE_URL"),apiKey:t=ks("OPENAI_API_KEY"),organization:s=ks("OPENAI_ORG_ID")??null,project:n=ks("OPENAI_PROJECT_ID")??null,...r}={}){if(void 0===t)throw new Ts("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const o={apiKey:t,organization:s,project:n,...r,baseURL:e||"https://api.openai.com/v1"};if(!o.dangerouslyAllowBrowser&&"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator)throw new Ts("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:o.baseURL,timeout:o.timeout??6e5,httpAgent:o.httpAgent,maxRetries:o.maxRetries,fetch:o.fetch}),this.completions=new pn(this),this.chat=new gn(this),this.embeddings=new yn(this),this.files=new wn(this),this.images=new _n(this),this.audio=new Rn(this),this.moderations=new An(this),this.models=new kn(this),this.fineTuning=new Mn(this),this.beta=new Eo(this),this.batches=new Po(this),this.uploads=new Oo(this),this._options=o,this.apiKey=t,this.organization=s,this.project=n}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}stringifyQuery(e){return function(e,t={}){let s=e;const n=function(e=cn){if(void 0!==e.allowEmptyArrays&&"boolean"!=typeof e.allowEmptyArrays)throw new TypeError("`allowEmptyArrays` option can only be `true` or `false`, when provided");if(void 0!==e.encodeDotInKeys&&"boolean"!=typeof e.encodeDotInKeys)throw new TypeError("`encodeDotInKeys` option can only be `true` or `false`, when provided");if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");const t=e.charset||cn.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");let s=zs;if(void 0!==e.format){if(!tn.call(Qs,e.format))throw new TypeError("Unknown format option provided.");s=e.format}const n=Qs[s];let r,o=cn.filter;if(("function"==typeof e.filter||nn(e.filter))&&(o=e.filter),r=e.arrayFormat&&e.arrayFormat in sn?e.arrayFormat:"indices"in e?e.indices?"indices":"repeat":cn.arrayFormat,"commaRoundTrip"in e&&"boolean"!=typeof e.commaRoundTrip)throw new TypeError("`commaRoundTrip` must be a boolean, or absent");const i=void 0===e.allowDots?1==!!e.encodeDotInKeys||cn.allowDots:!!e.allowDots;return{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:cn.addQueryPrefix,allowDots:i,allowEmptyArrays:"boolean"==typeof e.allowEmptyArrays?!!e.allowEmptyArrays:cn.allowEmptyArrays,arrayFormat:r,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:cn.charsetSentinel,commaRoundTrip:!!e.commaRoundTrip,delimiter:void 0===e.delimiter?cn.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:cn.encode,encodeDotInKeys:"boolean"==typeof e.encodeDotInKeys?e.encodeDotInKeys:cn.encodeDotInKeys,encoder:"function"==typeof e.encoder?e.encoder:cn.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:cn.encodeValuesOnly,filter:o,format:s,formatter:n,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:cn.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:cn.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:cn.strictNullHandling}}(t);let r,o;"function"==typeof n.filter?(o=n.filter,s=o("",s)):nn(n.filter)&&(o=n.filter,r=o);const i=[];if("object"!=typeof s||null===s)return"";const a=sn[n.arrayFormat],c="comma"===a&&n.commaRoundTrip;r||(r=Object.keys(s)),n.sort&&r.sort(n.sort);const l=new WeakMap;for(let e=0;e<r.length;++e){const t=r[e];n.skipNulls&&null===s[t]||on(i,un(s[t],t,a,c,n.allowEmptyArrays,n.strictNullHandling,n.skipNulls,n.encodeDotInKeys,n.encode?n.encoder:null,n.filter,n.sort,n.allowDots,n.serializeDate,n.format,n.formatter,n.encodeValuesOnly,n.charset,l))}const u=i.join(n.delimiter);let h=!0===n.addQueryPrefix?"?":"";return n.charsetSentinel&&("iso-8859-1"===n.charset?h+="utf8=%26%2310003%3B&":h+="utf8=%E2%9C%93&"),u.length>0?h+u:""}(e,{arrayFormat:"brackets"})}}uo=$o,$o.OpenAI=uo,$o.DEFAULT_TIMEOUT=6e5,$o.OpenAIError=Ts,$o.APIError=js,$o.APIConnectionError=Bs,$o.APIConnectionTimeoutError=qs,$o.APIUserAbortError=Ns,$o.NotFoundError=Ws,$o.ConflictError=Fs,$o.RateLimitError=Hs,$o.BadRequestError=Ds,$o.AuthenticationError=Ls,$o.InternalServerError=Js,$o.PermissionDeniedError=Us,$o.UnprocessableEntityError=Xs,$o.toFile=Zt,$o.fileFromPath=Bt;const{vc:Mo,LG:To,xX:jo,qA:No,cH:Bo,m_:qo,fK:Do,OE:Lo,v7:Uo,v3:Wo,PO:Fo,Ll:Xo,Is:Ho}=s;!function(e){e.Page=hn,e.CursorPage=dn,e.Completions=pn,e.Chat=gn,e.Embeddings=yn,e.Files=wn,e.FileObjectsPage=bn,e.Images=_n,e.Audio=Rn,e.Moderations=An,e.Models=kn,e.ModelsPage=En,e.FineTuning=Mn,e.Beta=Eo,e.Batches=Po,e.BatchesPage=Co,e.Uploads=Oo}($o||($o={})),new Set(["/completions","/chat/completions","/embeddings","/audio/transcriptions","/audio/translations","/audio/speech","/images/generations"]);const Jo=$o;let Vo,Ko;function zo(e){e.anthropicKey&&(Vo=new Pt({apiKey:e.anthropicKey,defaultHeaders:{"anthropic-dangerous-direct-browser-access":"true"}})),e.openaiKey&&(Ko=new Jo({apiKey:e.openaiKey}))}chrome.storage.local.get(["settings"],(e=>{zo(e.settings||{})})),chrome.storage.onChanged.addListener(((e,t)=>{"local"===t&&e.settings&&zo(e.settings.newValue)})),chrome.runtime.onMessage.addListener(((e,t,s)=>{if("getCompletion"===e.action)return async function(e,t){try{let s;if("claude-3-5-sonnet-20240620"===t&&Vo)s=(await Vo.messages.create({model:t,messages:[{role:"user",content:e}],system:"You are a helpful assistant which objective is to generate input data based on used prompt. The generated data would be used as the input of an input html text element and must be concise yet have meaning. If there is any current input value under CURRENT_INPUT_VALUE, use it for context of the prompt. Do not text back any other information other than the new input value ",max_tokens:4096})).content[0].text;else{if(!Ko)throw new Error("Unsupported model or API key not set");s=(await Ko.chat.completions.create({model:t,messages:[{role:"system",content:"You are a helpful assistant which objective is to generate input data based on used prompt. The generated data would be used as the input of an input html text element and must be concise yet have meaning. If there is any current input value under CURRENT_INPUT_VALUE, use it for context of the prompt. Do not text back any other information other than the new input value "},{role:"user",content:e}],max_tokens:4096})).choices[0].message.content||""}return{completion:s,error:"",prompt:e}}catch(t){return console.error("Error getting completion:",t,e),{completion:"Error: Unable to get completion",error:t,prompt:e}}}(e.prompt,e.model).then(s),!0;"openSettingsPage"===e.action&&chrome.tabs.create({url:chrome.runtime.getURL("options.html")})})),chrome.commands.onCommand.addListener((e=>{"_execute_action"===e&&chrome.tabs.query({active:!0,currentWindow:!0},(e=>{e[0].id&&chrome.tabs.sendMessage(e[0].id,{action:"activateAutocomplete"})}))}))})();